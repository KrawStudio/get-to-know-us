<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сон Журавля</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ... (все предыдущие стили остаются без изменений) ... */

        /* Кнопка управления подсказками */
        .hints-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(139, 69, 19, 0.9);
            color: #e8d8c0;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            z-index: 20;
            transition: background-color 0.3s;
            display: none;
        }
        
        .hints-toggle:hover {
            background-color: rgba(160, 82, 45, 0.9);
        }
        
        a {
            color: #d4af37;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Игровое поле -->
        <div class="game-board" id="game-board"></div>
        
        <!-- Заголовки -->
        <div class="title-container">
            <h1 class="title">СОН ЖУРАВЛЯ</h1>
            <p class="subtitle">узнайте нас лучше</p>
        </div>
        
        <!-- Колода -->
        <div class="deck" id="deck"></div>
        
        <!-- Кнопка управления подсказками -->
        <button class="hints-toggle" id="hints-toggle">Отключить подсказки</button>
        
        <!-- Подсказки -->
        <div class="hint hint-right-center" id="hint-right-center">
            <span class="hint-close" onclick="closeHint('hint-right-center')">×</span>
            Доступные действия: Выложить карту стартовой локации
        </div>
        <div class="hint hint-right-deck" id="hint-right-deck" style="display: none;">
            <span class="hint-close" onclick="closeHint('hint-right-deck')">×</span>
            Доступные действия: <br>&lt;&lt;&lt; Выложить новые карты локаций
        </div>
        <div class="hint hint-bottom" id="hint-bottom" style="display: none;">
            <span class="hint-close" onclick="closeHint('hint-bottom')">×</span>
            <span id="hint-bottom-text"></span>
        </div>
        
        <!-- Модальное окно -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <h2 id="modal-title"></h2>
                <div id="modal-text"></div>
                <div id="battle-content" style="display: none;">
                    <div class="battle-buttons" id="battle-buttons"></div>
                    <div class="roll-result" id="roll-result" style="display: none;"></div>
                </div>
                <button id="modal-close" style="display: none;">Вернуться к игре</button>
                <button id="modal-finish" style="display: none;">Завершить путешествие</button>
            </div>
        </div>
        
        <!-- Финальный экран -->
        <div class="final-screen" id="final-screen">
            <div class="final-content">
                <h2>Спасибо за то, что сыграли с нами!</h2>
                <p>Ценим ваши время и комфорт, поэтому собрали всю информацию в <a href="https://docs.google.com/document/d/1H75S1BBUs6KEq8VO2hk8cX6vKmiYZozbT5AOnwoe9no/edit?usp=sharing" target="_blank">этом документе</a></p>
                <p>Вы можете связаться с нами по:<br>
                Почте: kraw.gamedev.studio@gmail.com<br>
                ТГ: @ostegy или @saashaaa24</p>
                <p>— Ваша Kraw Studio. Не прощаемся!</p>
            </div>
        </div>
    </div>

    <script>
        // Состояние игры
        const gameState = {
            currentLocation: null,
            items: [],
            locations: {},
            directions: [],
            phase: 'start',
            monster1Defeated: false,
            monster2Defeated: false,
            monster3Defeated: false,
            locationGrid: {},
            currentPosition: { x: 0, y: 0 },
            locationHistory: [],
            cardScale: 1.0,
            allLocations: [],
            activeCardHint: null,
            battleState: {
                firstRollDone: false,
                dollUsed: false,
                swordReceived: false
            },
            locationOrder: ['start', 'about', 'monster1', 'purpose', 'monster2', 'coop', 'monster3', 'team'],
            openedLocations: [],
            directionsActive: false,
            hintsEnabled: true, // Включены ли подсказки
            visitedLocations: [] // Какие локации уже посещались
        };

        // DOM элементы
        const deck = document.getElementById('deck');
        const gameBoard = document.getElementById('game-board');
        const hintRightCenter = document.getElementById('hint-right-center');
        const hintRightDeck = document.getElementById('hint-right-deck');
        const hintBottom = document.getElementById('hint-bottom');
        const hintBottomText = document.getElementById('hint-bottom-text');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const modalClose = document.getElementById('modal-close');
        const modalFinish = document.getElementById('modal-finish');
        const battleContent = document.getElementById('battle-content');
        const battleButtons = document.getElementById('battle-buttons');
        const rollResult = document.getElementById('roll-result');
        const titleContainer = document.querySelector('.title-container');
        const finalScreen = document.getElementById('final-screen');
        const hintsToggle = document.getElementById('hints-toggle');

        // Обработчик клика на колоду
        deck.addEventListener('click', handleDeckClick);

        // Обработчик закрытия модального окна
        modalClose.addEventListener('click', () => {
            modal.classList.remove('active');
            resetItemCardsPosition();
            gameState.battleState.firstRollDone = false;
            gameState.battleState.dollUsed = false;
            gameState.battleState.swordReceived = false;
            modalClose.style.display = 'none';
            setDirectionsActive(false);
            
            // Показываем подсказку справа от колоды только если не на уже посещенной локации
            if (!isCurrentLocationVisited()) {
                showHintRightDeck();
            }
        });

        // Обработчик завершения путешествия
        modalFinish.addEventListener('click', () => {
            modal.classList.remove('active');
            finalScreen.classList.add('active');
        });

        // Обработчик переключения подсказок
        hintsToggle.addEventListener('click', () => {
            gameState.hintsEnabled = !gameState.hintsEnabled;
            if (gameState.hintsEnabled) {
                hintsToggle.textContent = 'Отключить подсказки';
                // Показываем соответствующие подсказки для текущего состояния
                updateHintsForCurrentState();
            } else {
                hintsToggle.textContent = 'Включить подсказки';
                // Скрываем все подсказки
                hideAllHints();
            }
        });

        // Функция закрытия подсказки
        function closeHint(hintId) {
            document.getElementById(hintId).style.display = 'none';
        }

        // Проверка, была ли текущая локация уже посещена
        function isCurrentLocationVisited() {
            return gameState.visitedLocations.includes(gameState.currentLocation);
        }

        // Показать подсказку справа от колоды (в левом нижнем углу)
        function showHintRightDeck() {
            if (gameState.hintsEnabled) {
                hintRightDeck.style.display = 'block';
            }
        }

        // Скрыть подсказку справа от колоды
        function hideHintRightDeck() {
            hintRightDeck.style.display = 'none';
        }

        // Показать подсказку снизу
        function showHintBottom() {
            if (gameState.hintsEnabled) {
                hintBottom.style.display = 'block';
            }
        }

        // Скрыть подсказку снизу
        function hideHintBottom() {
            hintBottom.style.display = 'none';
        }

        // Скрыть все подсказки
        function hideAllHints() {
            hintRightCenter.style.display = 'none';
            hintRightDeck.style.display = 'none';
            hintBottom.style.display = 'none';
            hideActiveCardHint();
        }

        // Обновить подсказки для текущего состояния игры
        function updateHintsForCurrentState() {
            if (!gameState.hintsEnabled) return;
            
            // Сначала скрываем все подсказки
            hideAllHints();
            
            // Показываем соответствующие подсказки
            switch(gameState.phase) {
                case 'start':
                    hintRightCenter.style.display = 'block';
                    break;
                case 'locationCardsPlaced':
                    if (!isCurrentLocationVisited()) {
                        showHintBottom();
                        hintBottomText.innerHTML = 'Доступные действия: Выбрать направление<br><span style="line-height: 0.5;">V<br>V</span>';
                    }
                    break;
                case 'afterStart':
                case 'afterAbout':
                case 'afterMonster1':
                case 'afterPurpose':
                case 'afterMonster2':
                case 'afterCoop':
                case 'afterMonster3':
                    if (!isCurrentLocationVisited()) {
                        showHintRightDeck();
                    }
                    break;
            }
            
            // Если есть активная карта и локация не посещалась, показываем подсказку
            const activeCard = document.querySelector('.location-card.active');
            if (activeCard && !isCurrentLocationVisited() && gameState.hintsEnabled) {
                createActiveCardHint(activeCard);
            }
        }

        // Установить активность карт направлений
        function setDirectionsActive(active) {
            gameState.directionsActive = active;
            const directionCards = document.querySelectorAll('.direction-card');
            directionCards.forEach(card => {
                if (active) {
                    card.classList.remove('inactive');
                } else {
                    card.classList.add('inactive');
                }
            });
        }

        // Функция обработки клика на колоду
        function handleDeckClick() {
            hideHintRightCenter();
            hideHintRightDeck();
            hideHintBottom();
            hideActiveCardHint();

            switch(gameState.phase) {
                case 'start':
                    startGame();
                    break;
                case 'afterStart':
                case 'afterAbout':
                case 'afterMonster1':
                case 'afterPurpose':
                case 'afterMonster2':
                case 'afterCoop':
                case 'afterMonster3':
                    placeLocationCardsAroundCurrent();
                    break;
            }
        }

        // Скрыть подсказку справа от колоды в центре
        function hideHintRightCenter() {
            hintRightCenter.style.display = 'none';
        }

        // Начало игры
        function startGame() {
            deck.classList.add('in-corner');
            
            setTimeout(() => {
                titleContainer.querySelector('.title').textContent = 'Поздравляем с началом пути!';
                titleContainer.querySelector('.subtitle').style.display = 'none';
                showStartLocation();
            }, 800);
            
            gameState.phase = 'afterStart';
        }

        // Показать стартовую локацию
        function showStartLocation() {
            const startCard = document.createElement('div');
            startCard.className = 'card location-card fade-in active';
            startCard.style.backgroundImage = 'url("assets/start.png")';
            startCard.style.left = '50%';
            startCard.style.top = '50%';
            startCard.style.transform = 'translate(-50%, -50%)';
            startCard.style.opacity = '0';
            startCard.id = 'location-start';
            startCard.dataset.x = '0';
            startCard.dataset.y = '0';
            gameBoard.appendChild(startCard);
            
            gameState.allLocations.push({
                element: startCard,
                x: 0,
                y: 0,
                type: 'start'
            });
            
            gameState.openedLocations.push('start');
            gameState.visitedLocations.push('start');
            
            // Создаем подсказку под картой
            const hintUnderCard = document.createElement('div');
            hintUnderCard.className = 'hint-under-card';
            hintUnderCard.style.left = '50%';
            hintUnderCard.style.top = 'calc(50% + 130px)';
            hintUnderCard.style.transform = 'translateX(-50%)';
            hintUnderCard.innerHTML = '<span class="hint-close" onclick="this.parentElement.remove()">×</span>Эффект карты локации: начать игру на знакомство<br>Полученные предметы: куколка-оберег';
            hintUnderCard.id = 'hint-under-start';
            document.querySelector('.game-container').appendChild(hintUnderCard);
            
            setTimeout(() => {
                startCard.style.opacity = '1';
                hintUnderCard.style.opacity = '1';
                
                setTimeout(() => {
                    showItem('doll');
                }, 500);
                
                showHintRightDeck();
                
                gameState.currentLocation = 'start';
                gameState.locationGrid['0,0'] = 'start';
            }, 300);
        }

        // Показать карту предмета
        function showItem(itemType) {
            const itemCard = document.createElement('div');
            itemCard.className = 'card item-card fade-in';
            itemCard.style.backgroundImage = `url("assets/item-${itemType}.png")`;
            itemCard.id = `item-${itemType}`;
            
            if (itemType === 'doll' || itemType === 'sword') {
                itemCard.classList.add('side-item-card');
            } else if (itemType === 'amulet') {
                if (gameState.items.includes('sword')) {
                    itemCard.classList.add('side-item-card', 'left');
                } else {
                    itemCard.classList.add('side-item-card');
                }
            } else {
                itemCard.style.left = '60%';
                itemCard.style.top = '50%';
                itemCard.style.transform = 'translate(-50%, -50%)';
            }
            
            itemCard.style.opacity = '0';
            document.querySelector('.game-container').appendChild(itemCard);
            
            setTimeout(() => {
                itemCard.style.opacity = '1';
                gameState.items.push(itemType);
            }, 300);

            if (itemType === 'doll' || itemType === 'sword' || itemType === 'amulet') {
                itemCard.addEventListener('mouseenter', () => {
                    if (itemType === 'amulet' && gameState.items.includes('sword')) {
                        itemCard.style.transform = 'rotate(-90deg) translateX(90%) translateX(-160px) translateY(-30px)';
                    } else {
                        itemCard.style.transform = 'rotate(-90deg) translateX(90%) translateY(-30px)';
                    }
                });
                itemCard.addEventListener('mouseleave', () => {
                    if (itemType === 'amulet' && gameState.items.includes('sword')) {
                        itemCard.style.transform = 'rotate(-90deg) translateX(90%) translateX(-160px)';
                    } else {
                        itemCard.style.transform = 'rotate(-90deg) translateX(90%)';
                    }
                });
            }
        }

        // Размещение карт локаций вокруг текущей позиции
        function placeLocationCardsAroundCurrent() {
            const hintUnderStart = document.getElementById('hint-under-start');
            if (hintUnderStart) {
                hintUnderStart.remove();
            }
            
            titleContainer.style.opacity = '0';
            
            const { x, y } = gameState.currentPosition;
            
            const positions = [
                { x: x, y: y - 1, direction: 'up' },
                { x: x + 1, y: y, direction: 'right' },
                { x: x, y: y + 1, direction: 'down' },
                { x: x - 1, y: y, direction: 'left' }
            ];
            
            positions.forEach((pos, index) => {
                const key = `${pos.x},${pos.y}`;
                
                if (!gameState.locationGrid[key]) {
                    const locationCard = document.createElement('div');
                    locationCard.className = 'card location-card';
                    locationCard.style.backgroundImage = 'url("assets/back.png")';
                    locationCard.style.opacity = '0';
                    locationCard.dataset.x = pos.x;
                    locationCard.dataset.y = pos.y;
                    locationCard.dataset.direction = pos.direction;
                    
                    gameState.allLocations.push({
                        element: locationCard,
                        x: pos.x,
                        y: pos.y,
                        type: 'closed'
                    });
                    
                    gameBoard.appendChild(locationCard);
                    
                    setTimeout(() => {
                        locationCard.style.opacity = '1';
                    }, index * 200);
                    
                    gameState.locationGrid[key] = 'closed';
                }
            });
            
            updateAllCardsPositions();
            showDirectionCards();
            setDirectionsActive(true);
            
            // Обновляем подсказки для нового состояния
            updateHintsForCurrentState();
            
            gameState.phase = 'locationCardsPlaced';
        }

        // Обновить позиции всех карт с учетом масштабирования
        function updateAllCardsPositions() {
            let minX = 0, maxX = 0, minY = 0, maxY = 0;
            
            gameState.allLocations.forEach(loc => {
                minX = Math.min(minX, loc.x);
                maxX = Math.max(maxX, loc.x);
                minY = Math.min(minY, loc.y);
                maxY = Math.max(maxY, loc.y);
            });
            
            const gridWidth = maxX - minX + 1;
            const gridHeight = maxY - minY + 1;
            
            const maxGridSize = Math.max(gridWidth, gridHeight);
            if (maxGridSize <= 3) {
                gameState.cardScale = 1.0;
            } else if (maxGridSize <= 5) {
                gameState.cardScale = 0.8;
            } else if (maxGridSize <= 7) {
                gameState.cardScale = 0.6;
            } else {
                gameState.cardScale = 0.5;
            }
            
            const cardSize = 220 * gameState.cardScale;
            const spacing = 0;
            
            const totalWidth = gridWidth * (cardSize + spacing) - spacing;
            const totalHeight = gridHeight * (cardSize + spacing) - spacing;
            
            gameState.allLocations.forEach(loc => {
                const relativeX = loc.x - minX;
                const relativeY = loc.y - minY;
                
                loc.element.style.width = `${cardSize}px`;
                loc.element.style.height = `${cardSize}px`;
                
                const left = (relativeX * (cardSize + spacing)) + (2100 - totalWidth) / 2;
                const top = (relativeY * (cardSize + spacing)) + (1100 - totalHeight) / 2;
                
                loc.element.style.left = `${left}px`;
                loc.element.style.top = `${top}px`;
                loc.element.style.transform = 'none';
            });
        }

        // Показать карты направлений
        function showDirectionCards() {
            document.querySelectorAll('.direction-card').forEach(card => card.remove());
            
            const directions = ['up', 'right', 'down', 'left'];
            const positions = [
                { left: '35%', bottom: '5%' },
                { left: '45%', bottom: '5%' },
                { left: '55%', bottom: '5%' },
                { left: '65%', bottom: '5%' }
            ];
            
            directions.forEach((dir, index) => {
                const directionCard = document.createElement('div');
                directionCard.className = 'card direction-card hidden-direction';
                directionCard.style.backgroundImage = `url("assets/direction-${dir}.png")`;
                directionCard.style.left = positions[index].left;
                directionCard.style.bottom = positions[index].bottom;
                directionCard.dataset.direction = dir;
                
                if (!gameState.directionsActive) {
                    directionCard.classList.add('inactive');
                }
                
                document.querySelector('.game-container').appendChild(directionCard);
                
                directionCard.addEventListener('click', () => {
                    if (!gameState.directionsActive) return;
                    
                    hideHintBottom();
                    setDirectionsActive(false);
                    handleDirectionClick(dir);
                });
            });
        }

        // Создать подсказку для активной карты
        function createActiveCardHint(cardElement) {
            hideActiveCardHint();
            
            if (isCurrentLocationVisited() || !gameState.hintsEnabled) return;
            
            const cardRect = cardElement.getBoundingClientRect();
            const hint = document.createElement('div');
            hint.className = 'hint-active-card';
            hint.innerHTML = '<span class="hint-close" onclick="this.parentElement.remove()">×</span>Доступные действия: Применить эффект локации';
            hint.id = 'hint-active-card';
            
            const cardTop = cardRect.top;
            const cardBottom = cardRect.bottom;
            const cardLeft = cardRect.left;
            const cardRight = cardRect.right;
            const windowHeight = window.innerHeight;
            
            if (cardTop < windowHeight * 0.2 || cardBottom > windowHeight * 0.8) {
                hint.style.left = `${cardRight + 10}px`;
                hint.style.top = `${cardTop}px`;
                hint.style.transform = 'translateY(0)';
            } else {
                hint.style.left = `${cardLeft}px`;
                hint.style.top = `${cardBottom + 10}px`;
                hint.style.transform = 'translateX(0)';
            }
            
            document.querySelector('.game-container').appendChild(hint);
            gameState.activeCardHint = hint;
            
            const originalClickHandler = cardElement.onclick;
            cardElement.onclick = function(event) {
                hideActiveCardHint();
                if (originalClickHandler) {
                    originalClickHandler.call(this, event);
                }
            };
        }

        // Скрыть подсказку активной карты
        function hideActiveCardHint() {
            if (gameState.activeCardHint) {
                gameState.activeCardHint.remove();
                gameState.activeCardHint = null;
            }
        }

        // Изменить позицию карт предметов для боя
        function setupItemCardsForBattle() {
            const itemCards = document.querySelectorAll('.item-card');
            itemCards.forEach(card => {
                card.style.opacity = '0.3';
            });
        }

        // Вернуть карты предметов в исходное положение
        function resetItemCardsPosition() {
            const itemCards = document.querySelectorAll('.item-card');
            itemCards.forEach(card => {
                card.style.opacity = '1';
                if (card.id === 'item-doll' || card.id === 'item-sword') {
                    card.style.transform = 'rotate(-90deg) translateX(90%)';
                } else if (card.id === 'item-amulet') {
                    if (gameState.items.includes('sword')) {
                        card.style.transform = 'rotate(-90deg) translateX(90%) translateX(-160px)';
                    } else {
                        card.style.transform = 'rotate(-90deg) translateX(90%)';
                    }
                } else {
                    card.style.left = '60%';
                    card.style.top = '50%';
                    card.style.transform = 'translate(-50%, -50%)';
                }
            });
        }

        // Обработка клика на карту направления
        function handleDirectionClick(direction) {
            let newX = gameState.currentPosition.x;
            let newY = gameState.currentPosition.y;
            
            switch(direction) {
                case 'up': newY--; break;
                case 'right': newX++; break;
                case 'down': newY++; break;
                case 'left': newX--; break;
            }
            
            const newPositionKey = `${newX},${newY}`;
            
            if (gameState.locationGrid[newPositionKey]) {
                if (gameState.locationGrid[newPositionKey] !== 'closed') {
                    document.querySelectorAll('.location-card').forEach(card => {
                        card.classList.remove('active');
                    });
                    
                    const newActiveCard = document.querySelector(`.location-card[data-x="${newX}"][data-y="${newY}"]`);
                    if (newActiveCard) {
                        newActiveCard.classList.add('active');
                        if (!gameState.visitedLocations.includes(gameState.locationGrid[newPositionKey]) && gameState.hintsEnabled) {
                            createActiveCardHint(newActiveCard);
                        }
                    }
                    
                    gameState.currentPosition = { x: newX, y: newY };
                    gameState.currentLocation = gameState.locationGrid[newPositionKey];
                    
                    // Если локация уже посещалась, оставляем карты направлений активными
                    if (isCurrentLocationVisited()) {
                        setDirectionsActive(true);
                        updateHintsForCurrentState();
                    } else {
                        gameState.visitedLocations.push(gameState.currentLocation);
                    }
                    
                    updateGamePhase();
                } else {
                    openLocationCard(newX, newY, direction);
                }
            }
        }

        // Определить следующую локацию для открытия
        function getNextLocationType() {
            for (let locationType of gameState.locationOrder) {
                if (!gameState.openedLocations.includes(locationType)) {
                    return locationType;
                }
            }
            return 'team';
        }

        // Открыть карту локации
        function openLocationCard(x, y, direction) {
            const positionKey = `${x},${y}`;
            const locationType = getNextLocationType();
            const locationCard = document.querySelector(`.card.location-card[data-x="${x}"][data-y="${y}"]`);
            
            if (locationCard) {
                locationCard.style.backgroundImage = `url("assets/card-${locationType}.png")`;
                
                document.querySelectorAll('.location-card').forEach(card => {
                    card.classList.remove('active');
                });
                
                locationCard.classList.add('active');
                if (!gameState.visitedLocations.includes(locationType) && gameState.hintsEnabled) {
                    createActiveCardHint(locationCard);
                }
                
                gameState.locationGrid[positionKey] = locationType;
                gameState.currentPosition = { x, y };
                gameState.currentLocation = locationType;
                
                gameState.openedLocations.push(locationType);
                gameState.visitedLocations.push(locationType);
                
                const locationInArray = gameState.allLocations.find(loc => loc.x === x && loc.y === y);
                if (locationInArray) {
                    locationInArray.type = locationType;
                }
                
                if (locationType === 'about' || locationType === 'purpose' || locationType === 'coop' || locationType === 'team') {
                    locationCard.addEventListener('click', () => {
                        showLocationEffect(locationType);
                    });
                } else if (locationType.includes('monster')) {
                    locationCard.addEventListener('click', () => {
                        showMonsterBattle(locationType);
                    });
                }
                
                // Показываем кнопку управления подсказками после открытия локации "about"
                if (locationType === 'about') {
                    hintsToggle.style.display = 'block';
                }
                
                updateGamePhase();
                updateHintsForCurrentState();
            }
        }

        // Обновить фазу игры
        function updateGamePhase() {
            switch(gameState.currentLocation) {
                case 'about': gameState.phase = 'afterAbout'; break;
                case 'monster1': gameState.phase = 'afterMonster1'; break;
                case 'purpose': gameState.phase = 'afterPurpose'; break;
                case 'monster2': gameState.phase = 'afterMonster2'; break;
                case 'coop': gameState.phase = 'afterCoop'; break;
                case 'monster3': gameState.phase = 'afterMonster3'; break;
                case 'team': showTeamLocation(); break;
            }
        }

        // Показать эффект локации
        function showLocationEffect(locationType) {
            let title, text;
            
            switch(locationType) {
                case 'about':
                    title = 'ОБ ИГРЕ';
                    text = `
                        <h3>ЛОР</h3>
                        <p>Сеттинг – временной период после русско-японской войны<br>
                        Бэкграунд игрового цикла – солдат, вернувшийся с войны во снах видит кошмары, где сражается с японскими мифическими существами.</p>
                        
                        <p>Таким образом игра представляет собой борьбу с внутренними монстрами (ПТСР) и, в зависимости от исхода партии, исцеление или безумие героя<br>
                        Формат игры – один против всех. Герой против трех монстров</p>
                        
                        <p>На этой локации применяется эффект: «получение сакральных знаний»</p>
                        
                        <h3>ИГРОВОЙ ЦИКЛ</h3>
                        
                        <p><strong>Фаза 1. «Погружение в сон»</strong><br>
                        > Герой выкладывает необходимое количество карт локаций так, чтобы все стороны одной из уже выложенных карт были «закрыты» другими картами</p>
                        
                        <p><strong>Фаза 2. «Пора бежать»</strong><br>
                        > Все игроки набирают по четыре карты направлений</p>
                        
                        <p><strong>Фаза 3. «Муки выбора»</strong><br>
                        > Игроки принимают решение куда идти и выкладывают соответствующую карту направления взакрытую.</p>
                        
                        <p><strong>Фаза 4. «Столкновение»</strong><br>
                        > Карты направлений вскрываются. Проверяется произошло ли столкновение.<br>
                        >> Если не произошло – игроки возвращаются к фазе «погружение в сон»<br>
                        >> Если произошло – игроки, оказавшиеся на одной локации начинают сражение</p>
                        
                        <p><strong>Фаза 5. «Сражение»</strong><br>
                        > Сражающиеся принимают решение о необходимости использовать предметы/навыки<br>
                        > Возвращение к 1 фазе.</p>
                        
                        <p>Конечно, нюансов гораздо больше, но пока что, кажется, информации достаточно :)</p>
                    `;
                    break;
                case 'purpose':
                    title = 'ДЛЯ КОГО И ЗАЧЕМ';
                    text = `
                        <p>На этой локации применяется эффект: «приоткрыть завесу тайны».</p>
                        
                        <p>Ядро нашей аудитории — «Игровой лидер». Это человек, который знакомит друзей с новыми играми, «заряжает» компанию, читает правила и является душей компании. Мы создаём игру, которая станет его новым козырем в коллекции.</p>
                        
                        <p>Наша игра идеально подойдёт для трёх сегментов игроков:</p>
                        
                        <p><strong>Стратеги и тактики.</strong> Тем, кто любит выстраивать стратегии, комбинировать карты и наслаждаться чувством контроля над сложной системой.</p>
                        
                        <p><strong>Фанаты мифологии.</strong> Те, кто изучает культуру стран, любит погружаться в атмосферные сеттинги. Это люди, которые увлекаются русским и/или японским фольклором, а еще оценят их тонкое переплетение.</p>
                        
                        <p><strong>Визуалы и эстеты.</strong> Те, для кого важен визуальный стиль. Мы создаем визуал, где старославянские узоры встречаются с лаконичной японской графикой.</p>
                        
                        <p><strong>Кому понравится? (Смежный игровой опыт):</strong><br>
                        Если вы играли в:<br>
                        «Ярость дракулы»,<br>
                        «Шепот за стеной»,<br>
                        «Нечто»,<br>
                        «Тираны подземья»,<br>
                        «Иниш»,<br>
                        «Кто накормит кракена?».<br>
                        То вероятнее всего, вам порекомендуют «Сон журавля».</p>
                    `;
                    break;
                case 'coop':
                    title = 'СОТРУДНИЧЕСТВО';
                    text = `
                        <p>На этой локации применяется эффект: «стать друзьями».</p>
                        
                        <h3>Что мы предлагаем партнёру-издателю:</h3>
                        
                        <p><strong>Готовый, протестированный концепт</strong><br>
                        Мы предлагаем прототип настольной игры с продуманным дизайном карт, правилами и готовой визуальной концепцией. Весь предпродакшн — на нас.</p>
                        
                        <p><strong>Уникальное трансмедийное преимущество.</strong><br>
                        Параллельно мы ведём разработку компьютерной игры «Сон журавля» — это трансмедийное расширение настольной, но более нарративно насыщенная и продолжительная игра, предназначенная для личного прохождения.</p>
                        
                        <p>С точки зрения маркетинга — это хорошая возможность для кросс-промоушена. Выход компьютерной игры подогреет интерес к настольной, и наоборот. Мы создаём целый мир для нашей аудитории.</p>
                        
                        <p><strong>Инициативная и вовлечённая команда.</strong><br>
                        Мы горим своим проектом. Мы готовы активно участвовать на всех этапах: от доработки дизайна и организации тестирований до поддержки маркетинговых активностей. Будем рады стать вашими партнерами!</p>
                        
                        <h3>Что мы ищем от партнёра:</h3>
                        
                        <p><strong>Экспертизу и поддержку в издании.</strong><br>
                        Мы хотим работать с профессионалами, которые помогут нам вывести игру на рынок и поддержать нас на этапах производстве продукции и дистрибуции.</p>
                        
                        <p><strong>Партнёрство в маркетинге и продвижении.</strong><br>
                        Мы верим в наш продукт и готовы вкладывать силы, но нам нужна ваша мощь и опыт в том, чтобы громмо заявить о себе и донести игру до нашей целевой аудитории.</p>
                    `;
                    break;
            }
            
            modalTitle.textContent = title;
            modalText.innerHTML = text;
            battleContent.style.display = 'none';
            modalClose.style.display = 'block';
            modal.classList.add('active');
        }

        // Показать битву с монстром
        function showMonsterBattle(monsterType) {
            let monsterText, strength;
            
            switch(monsterType) {
                case 'monster1':
                    monsterText = 'Вы выходите из чащи на краю заброшенного рисового поля. Воздух густой и сладковатый от запаха гниющих стеблей. Посреди грязи, под низко нависшим туманом, стоит неестественно прямой скелет в пропитанной грязью, рваной японской военной форме. Пустой череп медленно поворачивается в вашу сторону с тихим скрежетом. Его костяные пальцы сжимают древко ржавого штыка-мебари.';
                    strength = 10;
                    break;
                case 'monster2':
                    monsterText = 'Пройдя заросший двор, вы замечаете у разбитого колодца одинокую фигуру женщины в потёртом, но чистом кимоно. Она сидит на корточках, беззвучно рыдая, а её длинные, чёрные волосы скрывают лицо. Воздух неподвижен, и лишь лунный свет выхватывает её из тьмы. При вашем приближении она поднимает голову. Её лицо бледно и прекрасно, но искажено безмолвной тоской. Она что-то шепчет, но вы слышите лишь шелест листвы. Пока вы не замечаете, что тень от её шеи на каменной плите неестественно длинна и извивается, как змея. Ещё миг — и раздастся сухой, костяной хруст, и её голова на гибкой, вытягивающейся шее рванётся к вам с шипящим воплем.';
                    strength = 11;
                    break;
                case 'monster3':
                    monsterText = 'Вы пробираетесь сквозь частокол высохших стеблей, и воздух с каждой секундой становится гуще. Впереди, в просвете между стволами, вы видите покосившуюся хижину. У входа, спиной к вам, сидит женщина в алом кимоно, нежно напевающая колыбельную. Ее длинные волосы струятся по спине, сливаясь с тенями. Но что-то не так... вы замечаете, что с корявых ветвей над ней свисают не лозы, а шелковистые коконы, некоторые из которых тихо шевелятся. Женщина оборачивается. Ее лицо поразительной красоты искажено голодной улыбкой, а за спиной, в тенях, плавно расходятся в стороны несколько длинных, блестящих, хитиновых конечностей. Ее рот открывается, и раздается нечеловеческий, щелкающий хрип.';
                    strength = 12;
                    break;
            }
            
            modalTitle.textContent = 'ВСТРЕЧА С МОНСТРОМ';
            modalText.innerHTML = `${monsterText}<br><br><strong>Сила противника – ${strength}</strong>`;
            
            setupItemCardsForBattle();
            
            battleContent.style.display = 'block';
            battleButtons.innerHTML = '';
            rollResult.style.display = 'none';
            
            if (monsterType === 'monster1') {
                const attackButton = document.createElement('button');
                attackButton.className = 'battle-button';
                attackButton.textContent = 'Бросить кубики, чтобы атаковать';
                attackButton.addEventListener('click', () => {
                    handleFirstMonsterAttack();
                });
                battleButtons.appendChild(attackButton);
            } else if (monsterType === 'monster2') {
                const buttonRow = document.createElement('div');
                buttonRow.className = 'battle-button-row';
                
                const bareHandsButton = document.createElement('button');
                bareHandsButton.className = 'battle-button';
                bareHandsButton.textContent = 'Биться голыми руками';
                bareHandsButton.addEventListener('click', () => {
                    bareHandsButton.disabled = true;
                    swordButton.disabled = true;
                    handleSecondMonsterBareHands();
                });
                
                const swordButton = document.createElement('button');
                swordButton.className = 'battle-button';
                swordButton.textContent = 'Использовать Меч-кладенец';
                swordButton.addEventListener('click', () => {
                    bareHandsButton.disabled = true;
                    swordButton.disabled = true;
                    handleSecondMonsterSword();
                });
                
                buttonRow.appendChild(bareHandsButton);
                buttonRow.appendChild(swordButton);
                battleButtons.appendChild(buttonRow);
            } else if (monsterType === 'monster3') {
                const buttonRow = document.createElement('div');
                buttonRow.className = 'battle-button-row';
                
                if (gameState.items.includes('sword')) {
                    const bareHandsButton = document.createElement('button');
                    bareHandsButton.className = 'battle-button';
                    bareHandsButton.textContent = 'Биться голыми руками';
                    bareHandsButton.addEventListener('click', () => {
                        bareHandsButton.disabled = true;
                        swordButton.disabled = true;
                        handleThirdMonsterAttack();
                    });
                    
                    const swordButton = document.createElement('button');
                    swordButton.className = 'battle-button';
                    swordButton.textContent = 'Использовать Меч-кладенец';
                    swordButton.addEventListener('click', () => {
                        bareHandsButton.disabled = true;
                        swordButton.disabled = true;
                        handleThirdMonsterAttack();
                    });
                    
                    buttonRow.appendChild(bareHandsButton);
                    buttonRow.appendChild(swordButton);
                } else {
                    const attackButton = document.createElement('button');
                    attackButton.className = 'battle-button';
                    attackButton.textContent = 'Бросить кубики, чтобы сразиться';
                    attackButton.addEventListener('click', () => {
                        attackButton.disabled = true;
                        handleThirdMonsterAttack();
                    });
                    buttonRow.appendChild(attackButton);
                }
                battleButtons.appendChild(buttonRow);
            }
            
            modalClose.style.display = 'none';
            modal.classList.add('active');
        }

        // Обработка атаки на первого монстра
        function handleFirstMonsterAttack() {
            const attackButton = battleButtons.querySelector('.battle-button');
            if (attackButton) {
                attackButton.disabled = true;
            }
            
            rollResult.style.display = 'block';
            rollResult.textContent = 'Результат бросков: 5 и 3. Кажется богатырской силушки не хватило... Хорошо, что при начале игры вы получили кое-какой подарок. Попробуйте использовать его!';
            
            const dollButton = document.createElement('button');
            dollButton.className = 'card-button';
            dollButton.style.backgroundImage = 'url("assets/item-doll.png")';
            dollButton.addEventListener('click', () => {
                useDollAgainstFirstMonster();
            });
            
            battleButtons.appendChild(dollButton);
            
            gameState.battleState.firstRollDone = true;
        }

        // Использование куколки против первого монстра
        function useDollAgainstFirstMonster() {
            const dollButton = battleButtons.querySelector('.card-button');
            if (dollButton) {
                dollButton.remove();
            }
            
            const dollCard = document.getElementById('item-doll');
            if (dollCard) {
                dollCard.style.opacity = '0';
                setTimeout(() => {
                    dollCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'doll');
                }, 500);
            }
            
            battleButtons.innerHTML = '';
            const attackAgainButton = document.createElement('button');
            attackAgainButton.className = 'battle-button';
            attackAgainButton.textContent = 'Атаковать еще раз';
            attackAgainButton.addEventListener('click', () => {
                handleFirstMonsterSecondAttack();
            });
            battleButtons.appendChild(attackAgainButton);
            
            rollResult.textContent = 'Куколка-оберег использована! Теперь попробуйте атаковать еще раз.';
            
            gameState.battleState.dollUsed = true;
        }

        // Вторая атака на первого монстра
        function handleFirstMonsterSecondAttack() {
            const attackAgainButton = battleButtons.querySelector('.battle-button');
            if (attackAgainButton) {
                attackAgainButton.disabled = true;
            }
            
            rollResult.textContent = 'Результат бросков: 5 и 5. Другое дело! Видим, теперь вы размялись. За победу над монстром применяется эффект локации «Получить оружие».';
            
            const swordButton = document.createElement('button');
            swordButton.className = 'card-button';
            swordButton.style.backgroundImage = 'url("assets/item-sword.png")';
            swordButton.disabled = true;
            
            battleButtons.appendChild(swordButton);
            
            modalClose.style.display = 'block';
            
            gameState.monster1Defeated = true;
            gameState.battleState.swordReceived = true;
            
            setTimeout(() => {
                showItem('sword');
            }, 1000);
        }

        // Обработка боя голыми руками со вторым монстром
        function handleSecondMonsterBareHands() {
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 6 и 6.\nВау! Да вы опытный боец! Поспешим в путь! И вновь применяем эффект карты локации – за победу над монстром получите предмет. Хотя, наверное, такому силачу уже никакие предметы не нужны';
            
            const amuletButton = document.createElement('button');
            amuletButton.className = 'card-button';
            amuletButton.style.backgroundImage = 'url("assets/item-amulet.png")';
            amuletButton.disabled = true;
            
            battleButtons.appendChild(amuletButton);
            
            modalClose.style.display = 'block';
            
            setTimeout(() => {
                showItem('amulet');
                gameState.monster2Defeated = true;
            }, 2000);
        }

        // Обработка боя с мечом со вторым монстром
        function handleSecondMonsterSword() {
            const swordCard = document.getElementById('item-sword');
            if (swordCard) {
                swordCard.style.opacity = '0';
                setTimeout(() => {
                    swordCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'sword');
                }, 500);
            }
            
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 5 и 4.\nВсегда важно грамотно рассчитать силы. Хорошо, что у вас в ножнах оказалось такое оружие! И вновь применяем эффект карты локации – за победу над монстром получите предмет.';
            
            const amuletButton = document.createElement('button');
            amuletButton.className = 'card-button';
            amuletButton.style.backgroundImage = 'url("assets/item-amulet.png")';
            amuletButton.disabled = true;
            
            battleButtons.appendChild(amuletButton);
            
            modalClose.style.display = 'block';
            
            setTimeout(() => {
                showItem('amulet');
                gameState.monster2Defeated = true;
            }, 2000);
        }

        // Обработка атаки на третьего монстра
        function handleThirdMonsterAttack() {
            if (gameState.items.includes('sword')) {
                rollResult.style.display = 'block';
                rollResult.textContent = 'результат бросков: 2 и 1.\nНичего страшного! Каждый имеет право на маленькие неудачи. Иначе было бы не так захватывающе, верно? Используйте амулет, чтобы поскорее выбраться из этой скользкой ситуации';
            } else {
                rollResult.style.display = 'block';
                rollResult.textContent = 'Результат броска – 3 и 3.\nНеплохо, но против такого чудовища недостаточно. Скорее используйте свой амулет, чтобы сбежать.';
            }
            
            const amuletButton = document.createElement('button');
            amuletButton.className = 'card-button';
            amuletButton.style.backgroundImage = 'url("assets/item-amulet.png")';
            amuletButton.addEventListener('click', () => {
                useAmuletToEscape();
            });
            
            battleButtons.appendChild(amuletButton);
        }

        // Использование амулета для побега
        function useAmuletToEscape() {
            const amuletButton = battleButtons.querySelector('.card-button');
            if (amuletButton) {
                amuletButton.remove();
            }
            
            const amuletCard = document.getElementById('item-amulet');
            if (amuletCard) {
                amuletCard.style.opacity = '0';
                setTimeout(() => {
                    amuletCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'amulet');
                }, 500);
            }
            
            modalFinish.style.display = 'block';
            gameState.monster3Defeated = true;
        }

        // Показать локацию "команда"
        function showTeamLocation() {
            modalTitle.textContent = 'КОМАНДА';
            modalText.innerHTML = `
                <p>На этой локации применяется эффект: «завершить сюжетную арку «знакомство»</p>
                
                <p>Мы – KRAW Studio. Группа инициативных любителей настольных игр (и не только)</p>
                
                <p>И да, мы достаточно амбициозны (или безумны), чтобы параллельно работать над компьютерной версией той же игровой вселенной. Мы верим в силу трансмедийности и хотим, чтобы наши игроки могли погрузиться в мир игры с любой стороны.</p>
                
                <h3>Наша команда:</h3>
                
                <p><strong>Настольная игра:</strong><br>
                Анастасия Оглы, Павел Алексеев — гейм-дизайнеры<br>
                Александра Юрченко и Олеся Кан — графические дизайнеры<br>
                Александра Волкова — нарративный дизайнер</p>
                
                <p><strong>Компьютерная игра</strong><br>
                Максим Усачев — автор идеи, разработчик.<br>
                Никита Старков — саунд-дизайнер.<br>
                Дарья Горбунова — левел-дизайнер.</p>
                
                <p>Рады познакомиться и надеемся, что вам было с нами весело! Предлагаем и дальше веселиться рука об руку, разрабатывая эту настольную игру!</p>
                
                <p><strong>Наши контакты:</strong><br>
                Почта: мяумяу<br>
                Наши тг: гав гав</p>
            `;
            battleContent.style.display = 'none';
            modalClose.style.display = 'block';
            modal.classList.add('active');
            
            hintRightDeck.style.display = 'none';
            hintBottom.style.display = 'none';
        }

        // Запуск инициализации при загрузке страницы
        window.addEventListener('load', () => {
            hintRightCenter.style.display = 'block';
        });
    </script>
</body>
</html>
