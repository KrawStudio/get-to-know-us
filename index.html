<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сон Журавля</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Playfair Display', serif;
            background-image: url('assets/wood.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            overflow: hidden;
            position: relative;
            color: #fff;
        }
        
        .game-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        /* Заголовки */
        .title-container {
            position: absolute;
            top: 40px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            transition: opacity 0.5s;
        }
        
        .title {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 24px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            letter-spacing: 1px;
        }
        
        /* Карты */
        .card {
            position: absolute;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.7);
            transition: all 0.8s ease;
            cursor: pointer;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .location-card {
            width: 220px;
            height: 220px;
        }
        
        .item-card, .direction-card {
            width: 150px;
            height: 220px;
        }
        
        .deck {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 220px;
            background-image: url('assets/back.png');
            background-size: cover;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.7);
            cursor: pointer;
            z-index: 5;
            transition: all 0.8s ease;
        }
        
        /* Подсказки */
        .hint {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 18px;
            max-width: 300px;
            line-height: 1.5;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .hint-right {
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .hint-bottom {
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 80%;
            max-width: 600px;
        }
        
        /* Трекер локации */
        .location-tracker {
            position: absolute;
            top: 30px;
            left: 30px;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 12px 18px;
            border-radius: 10px;
            font-size: 18px;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Модальное окно */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: rgba(30, 20, 10, 0.95);
            color: #e8d8c0;
            padding: 40px;
            border-radius: 15px;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.8);
            border: 2px solid #8B4513;
            font-size: 18px;
            line-height: 1.6;
        }
        
        .modal h2 {
            margin-bottom: 20px;
            font-size: 32px;
            text-align: center;
            color: #d4af37;
        }
        
        .modal h3 {
            margin: 20px 0 10px;
            color: #d4af37;
            font-size: 24px;
        }
        
        .modal p {
            margin-bottom: 15px;
        }
        
        .modal button {
            background-color: #8B4513;
            color: #e8d8c0;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            transition: background-color 0.3s;
        }
        
        .modal button:hover {
            background-color: #a0522d;
        }
        
        /* Кнопки сражения */
        .battle-buttons {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 10;
        }
        
        .battle-button {
            background-color: rgba(139, 69, 19, 0.9);
            color: #e8d8c0;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: background-color 0.3s;
        }
        
        .battle-button:hover {
            background-color: rgba(160, 82, 45, 0.9);
        }
        
        /* Результат броска */
        .roll-result {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            max-width: 500px;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Скрытые карты */
        .hidden-card {
            transform: translateX(80%) rotate(90deg);
            transition: transform 0.5s ease;
        }
        
        .hidden-card:hover {
            transform: translateX(60%) rotate(90deg);
        }
        
        .hidden-direction {
            transform: translateY(80%);
            transition: transform 0.5s ease;
        }
        
        .hidden-direction:hover {
            transform: translateY(60%);
        }
        
        /* Эффекты текста */
        .location-name {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            color: #d4af37;
            z-index: 5;
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease;
        }
        
        /* Контейнер для карт локаций вокруг центральной */
        .location-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 660px;
            height: 660px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
        }
        
        .grid-cell {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Заголовки -->
        <div class="title-container">
            <h1 class="title">СОН ЖУРАВЛЯ</h1>
            <p class="subtitle">узнайте нас лучше</p>
        </div>
        
        <!-- Колода -->
        <div class="deck" id="deck"></div>
        
        <!-- Подсказки -->
        <div class="hint hint-right" id="hint-right">&lt;&lt;&lt; Выложить стартовую локацию</div>
        <div class="hint hint-bottom" id="hint-bottom" style="display: none;"></div>
        
        <!-- Трекер локации -->
        <div class="location-tracker" id="location-tracker" style="display: none;"></div>
        
        <!-- Модальное окно -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <h2 id="modal-title"></h2>
                <div id="modal-text"></div>
                <button id="modal-close">Вернуться к игре</button>
            </div>
        </div>
        
        <!-- Результат броска -->
        <div class="roll-result" id="roll-result" style="display: none;"></div>
        
        <!-- Кнопки сражения -->
        <div class="battle-buttons" id="battle-buttons" style="display: none;"></div>
        
        <!-- Контейнер для карт локаций -->
        <div class="location-grid" id="location-grid" style="display: none;"></div>
    </div>

    <script>
        // Состояние игры
        const gameState = {
            currentLocation: null,
            items: [],
            locations: {},
            directions: [],
            phase: 'start',
            monster1Defeated: false,
            monster2Defeated: false,
            monster3Defeated: false,
            locationGrid: {}
        };

        // DOM элементы
        const deck = document.getElementById('deck');
        const hintRight = document.getElementById('hint-right');
        const hintBottom = document.getElementById('hint-bottom');
        const locationTracker = document.getElementById('location-tracker');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const modalClose = document.getElementById('modal-close');
        const rollResult = document.getElementById('roll-result');
        const battleButtons = document.getElementById('battle-buttons');
        const titleContainer = document.querySelector('.title-container');
        const locationGrid = document.getElementById('location-grid');

        // Обработчик клика на колоду
        deck.addEventListener('click', handleDeckClick);

        // Обработчик закрытия модального окна
        modalClose.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        // Функция обработки клика на колоду
        function handleDeckClick() {
            switch(gameState.phase) {
                case 'start':
                    startGame();
                    break;
                case 'afterStart':
                    placeLocationCards();
                    break;
                case 'afterAbout':
                    placeLocationCardsAround('about');
                    break;
                case 'afterMonster1':
                    placeLocationCardsAround('monster1');
                    break;
                case 'afterPurpose':
                    placeLocationCardsAround('purpose');
                    break;
                case 'afterMonster2':
                    placeLocationCardsAround('monster2');
                    break;
                case 'afterCoop':
                    placeLocationCardsAround('coop');
                    break;
                case 'afterMonster3':
                    placeLocationCardsAround('monster3');
                    break;
            }
        }

        // Начало игры
        function startGame() {
            // Перемещаем колоду
            deck.style.left = '10%';
            deck.style.top = '80%';
            deck.style.transform = 'translate(0, 0)';
            
            // Обновляем заголовки
            setTimeout(() => {
                titleContainer.querySelector('.title').textContent = 'Поздравляем с началом пути!';
                titleContainer.querySelector('.subtitle').style.display = 'none';
                
                // Показываем стартовую локацию
                showStartLocation();
            }, 800);
            
            gameState.phase = 'afterStart';
        }

        // Показать стартовую локацию
        function showStartLocation() {
            // Создаем карту стартовой локации
            const startCard = document.createElement('div');
            startCard.className = 'card location-card fade-in';
            startCard.style.backgroundImage = 'url("assets/start.png")';
            startCard.style.left = '50%';
            startCard.style.top = '50%';
            startCard.style.transform = 'translate(-50%, -50%)';
            startCard.style.opacity = '0';
            startCard.id = 'location-start';
            document.querySelector('.game-container').appendChild(startCard);
            
            // Добавляем название локации
            const locationName = document.createElement('div');
            locationName.className = 'location-name';
            locationName.textContent = 'СТАРТОВАЯ ЛОКАЦИЯ';
            startCard.appendChild(locationName);
            
            // Анимация появления
            setTimeout(() => {
                startCard.style.opacity = '1';
                
                // Показываем карту предмета
                setTimeout(() => {
                    showItem('doll');
                }, 500);
                
                // Обновляем подсказки
                hintRight.innerHTML = 'Доступные действия:<br>&lt;&lt;&lt; Выложить новые карты локаций';
                hintBottom.style.display = 'block';
                hintBottom.innerHTML = 'Эффект: начать игру на знакомство<br>Полученные предметы: куколка-оберег';
                
                // Сохраняем текущую локацию
                gameState.currentLocation = 'start';
                updateLocationTracker('Стартовая локация');
            }, 300);
        }

        // Показать карту предмета
        function showItem(itemType) {
            const itemCard = document.createElement('div');
            itemCard.className = 'card item-card fade-in';
            itemCard.style.backgroundImage = `url("assets/item-${itemType}.png")`;
            itemCard.style.left = '60%';
            itemCard.style.top = '50%';
            itemCard.style.transform = 'translate(-50%, -50%)';
            itemCard.style.opacity = '0';
            itemCard.id = `item-${itemType}`;
            document.querySelector('.game-container').appendChild(itemCard);
            
            // Анимация появления
            setTimeout(() => {
                itemCard.style.opacity = '1';
                
                // Добавляем в состояние игры
                gameState.items.push(itemType);
            }, 300);
        }

        // Размещение карт локаций вокруг стартовой локации
        function placeLocationCards() {
            // Убираем карту куколки
            const dollCard = document.getElementById('item-doll');
            if (dollCard) {
                dollCard.style.transform = 'translateX(80%) rotate(90deg)';
                dollCard.classList.add('hidden-card');
            }
            
            // Скрываем заголовок
            titleContainer.style.opacity = '0';
            
            // Создаем сетку для карт локаций
            locationGrid.style.display = 'grid';
            
            // Создаем 4 карты локаций вокруг центра
            const positions = [
                { row: 1, col: 2 }, // сверху
                { row: 2, col: 3 }, // справа
                { row: 3, col: 2 }, // снизу
                { row: 2, col: 1 }  // слева
            ];
            
            positions.forEach((pos, index) => {
                const gridCell = document.createElement('div');
                gridCell.className = 'grid-cell';
                gridCell.dataset.row = pos.row;
                gridCell.dataset.col = pos.col;
                locationGrid.appendChild(gridCell);
                
                const locationCard = document.createElement('div');
                locationCard.className = 'card location-card';
                locationCard.style.backgroundImage = 'url("assets/back.png")';
                locationCard.style.opacity = '0';
                locationCard.dataset.position = index;
                locationCard.dataset.location = 'about'; // Все ведут к карте "об игре"
                gridCell.appendChild(locationCard);
                
                // Анимация появления
                setTimeout(() => {
                    locationCard.style.opacity = '1';
                }, index * 200);
                
                // Обработчик клика
                locationCard.addEventListener('click', () => {
                    if (locationCard.style.backgroundImage.includes('back.png')) {
                        revealLocationCard(locationCard);
                    }
                });
            });
            
            // Показываем карты направлений
            showDirectionCards();
            
            // Обновляем подсказки
            hintBottom.textContent = 'Доступные действия: Выбрать направление';
            
            gameState.phase = 'locationCardsPlaced';
        }

        // Показать карты направлений
        function showDirectionCards() {
            const directions = ['up', 'right', 'down', 'left'];
            const positions = [
                { left: '35%', bottom: '10%' },
                { left: '45%', bottom: '10%' },
                { left: '55%', bottom: '10%' },
                { left: '65%', bottom: '10%' }
            ];
            
            directions.forEach((dir, index) => {
                const directionCard = document.createElement('div');
                directionCard.className = 'card direction-card hidden-direction';
                directionCard.style.backgroundImage = `url("assets/direction-${dir}.png")`;
                directionCard.style.left = positions[index].left;
                directionCard.style.bottom = positions[index].bottom;
                directionCard.dataset.direction = dir;
                document.querySelector('.game-container').appendChild(directionCard);
                
                // Обработчик клика
                directionCard.addEventListener('click', () => {
                    handleDirectionClick(dir);
                });
            });
        }

        // Обработка клика на карту направления
        function handleDirectionClick(direction) {
            // Определяем, какая карта должна открыться
            let targetLocation;
            
            switch(gameState.currentLocation) {
                case 'start':
                    // Все направления ведут к карте "об игре"
                    targetLocation = 'about';
                    break;
                case 'about':
                    // Одно из направлений ведет к монстру 1
                    targetLocation = 'monster1';
                    break;
                case 'monster1':
                    // Одно из направлений ведет к карте "для кого и зачем"
                    targetLocation = 'purpose';
                    break;
                case 'purpose':
                    // Одно из направлений ведет к монстру 2
                    targetLocation = 'monster2';
                    break;
                case 'monster2':
                    // Одно из направлений ведет к карте "сотрудничество"
                    targetLocation = 'coop';
                    break;
                case 'coop':
                    // Одно из направлений ведет к монстру 3
                    targetLocation = 'monster3';
                    break;
                case 'monster3':
                    // Одно из направлений ведет к карте "команда"
                    targetLocation = 'team';
                    break;
                default:
                    targetLocation = 'about';
            }
            
            // Обновляем трекер локации
            const locationNames = {
                'start': 'Стартовая локация',
                'about': 'Об игре',
                'monster1': 'Встреча с первым монстром',
                'purpose': 'Для кого и зачем',
                'monster2': 'Встреча со вторым монстром',
                'coop': 'Сотрудничество',
                'monster3': 'Встреча с третьим монстром',
                'team': 'Команда'
            };
            
            updateLocationTracker(locationNames[targetLocation]);
            
            // Показываем карту локации
            showLocationCard(targetLocation);
            
            // Обновляем состояние игры
            gameState.currentLocation = targetLocation;
            
            // Скрываем подсказку направлений
            hintBottom.style.display = 'none';
            
            // Обновляем фазу игры
            if (targetLocation === 'about') {
                gameState.phase = 'afterAbout';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (targetLocation === 'monster1') {
                gameState.phase = 'afterMonster1';
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Ой-ой, кажется вас нагнал монстр\nДоступные действия: сразиться';
                }, 1000);
            } else if (targetLocation === 'purpose') {
                gameState.phase = 'afterPurpose';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (targetLocation === 'monster2') {
                gameState.phase = 'afterMonster2';
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Ой-ой, кажется вы снова наткнулись на монстра\nДоступные действия: сразиться';
                }, 1000);
            } else if (targetLocation === 'coop') {
                gameState.phase = 'afterCoop';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (targetLocation === 'monster3') {
                gameState.phase = 'afterMonster3';
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Ой-ой, никогда такого не было, и вот опять…\nДоступные действия: сразиться';
                }, 1000);
            } else if (targetLocation === 'team') {
                // Конец игры
                showTeamLocation();
            }
        }

        // Показать карту локации
        function showLocationCard(locationType) {
            // Создаем карту локации
            const locationCard = document.createElement('div');
            locationCard.className = 'card location-card fade-in';
            locationCard.style.backgroundImage = `url("assets/card-${locationType}.png")`;
            locationCard.style.left = '50%';
            locationCard.style.top = '50%';
            locationCard.style.transform = 'translate(-50%, -50%)';
            locationCard.style.opacity = '0';
            locationCard.id = `location-${locationType}`;
            document.querySelector('.game-container').appendChild(locationCard);
            
            // Анимация появления
            setTimeout(() => {
                locationCard.style.opacity = '1';
                
                // Добавляем обработчик клика в зависимости от типа локации
                if (locationType === 'about' || locationType === 'purpose' || locationType === 'coop' || locationType === 'team') {
                    locationCard.addEventListener('click', () => {
                        showLocationEffect(locationType);
                    });
                    
                    // Показываем подсказку
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Доступные действия: Применить эффект локации';
                } else if (locationType.includes('monster')) {
                    locationCard.addEventListener('click', () => {
                        showMonsterBattle(locationType);
                    });
                }
            }, 300);
        }

        // Показать эффект локации
        function showLocationEffect(locationType) {
            let title, text;
            
            switch(locationType) {
                case 'about':
                    title = 'ОБ ИГРЕ';
                    text = `
                        <h3>ЛОР</h3>
                        <p>Сеттинг – временной период после русско-японской войны<br>
                        Бэкграунд игрового цикла – солдат, вернувшийся с войны во снах видит кошмары, где сражается с японскими мифическими существами.</p>
                        
                        <p>Таким образом игра представляет собой борьбу с внутренними монстрами (ПТСР) и, в зависимости от исхода партии, исцеление или безумие героя<br>
                        Формат игры – один против всех. Герой против трех монстров</p>
                        
                        <p>На этой локации применяется эффект: «получение сакральных знаний»</p>
                        
                        <h3>ИГРОВОЙ ЦИКЛ</h3>
                        
                        <p><strong>Фаза «Погружение в сон»</strong><br>
                        > Герой выкладывает необходимое количество карт локаций так, чтобы все стороны одной из уже выложенных карт были «закрыты» другими картами</p>
                        
                        <p><strong>Фаза «Пора бежать»</strong><br>
                        > Все игроки набирают по четыре карты направлений</p>
                        
                        <p><strong>Фаза «Муки выбора»</strong><br>
                        > Игроки принимают решение куда идти и выкладывают соответствующую карту направления взакрытую.</p>
                        
                        <p>Дальше >>></p>
                    `;
                    break;
                case 'purpose':
                    title = 'ДЛЯ КОГО И ЗАЧЕМ';
                    text = `
                        <p>На этой локации применяется эффект: «приоткрыть завесу тайны».</p>
                        
                        <p>Ядро нашей аудитории — «Игровой лидер». Это человек, который знакомит друзей с новыми играми, «заряжает» компанию, читает правила и является душой компании. Мы создаём игру, которая станет его новым козырем в коллекции.</p>
                        
                        <p>Наша игра идеально подойдёт для трёх сегментов игроков:</p>
                        
                        <p><strong>Стратеги и тактики.</strong> Тем, кто любит выстраивать стратегии, комбинировать карты и наслаждаться чувством контроля над сложной системой.</p>
                        
                        <p><strong>Фанаты мифологии.</strong> Те, кто изучает культуру стран, любит погружаться в атмосферные сеттинги. Это люди, которые увлекаются русским и/или японским фольклором, а еще оценят их тонкое переплетение.</p>
                        
                        <p><strong>Визуалы и эстеты.</strong> Те, для кого важен визуальный стиль. Мы создаем визуал, где старославянские узоры встречаются с лаконичной японской графикой.</p>
                        
                        <p><strong>Кому понравится? (Смежный игровой опыт):</strong><br>
                        Если вы играли в:<br>
                        «Ярость дракулы»,<br>
                        «Шепот за стеной»,<br>
                        «Нечто»,<br>
                        «Тираны подземья»,<br>
                        «Иниш»,<br>
                        «Кто накормит кракена?».<br>
                        То вероятнее всего, вам порекомендуют «Сон журавля».</p>
                    `;
                    break;
                case 'coop':
                    title = 'СОТРУДНИЧЕСТВО';
                    text = `
                        <p>На этой локации применяется эффект: «стать друзьями».</p>
                        
                        <h3>Что мы предлагаем партнёру-издателю:</h3>
                        
                        <p><strong>Готовый, протестированный концепт</strong><br>
                        Мы предлагаем прототип настольной игры с продуманным дизайном карт, правилами и готовой визуальной концепцией. Весь предпродакшн — на нас.</p>
                        
                        <p><strong>Уникальное трансмедийное преимущество.</strong><br>
                        Параллельно мы ведём разработку компьютерной игры «Сон журавля» — это трансмедийное расширение настольной, но более нарративно насыщенная и продолжительная игра, предназначенная для личного прохождения.</p>
                        
                        <p>С точки зрения маркетинга — это хорошая возможность для кросс-промоушена. Выход компьютерной игры подогреет интерес к настольной, и наоборот. Мы создаём целый мир для нашей аудитории.</p>
                        
                        <p><strong>Инициативная и вовлечённая команда.</strong><br>
                        Мы горим своим проектом. Мы готовы активно участвовать на всех этапах: от доработки дизайна и организации тестирований до поддержки маркетинговых активностей. Будем рады стать вашими партнерами!</p>
                        
                        <h3>Что мы ищем от партнёра:</h3>
                        
                        <p><strong>Экспертизу и поддержку в издании.</strong><br>
                        Мы хотим работать с профессионалами, которые помогут нам вывести игру на рынок и поддержать нас на этапах производстве продукции и дистрибуции.</p>
                        
                        <p><strong>Партнёрство в маркетинге и продвижении.</strong><br>
                        Мы верим в наш продукт и готовы вкладывать силы, но нам нужна ваша мощь и опыт в том, чтобы громко заявить о себе и донести игру до нашей целевой аудитории.</p>
                    `;
                    break;
            }
            
            modalTitle.textContent = title;
            modalText.innerHTML = text;
            modal.classList.add('active');
        }

        // Показать битву с монстром
        function showMonsterBattle(monsterType) {
            let monsterText, strength;
            
            switch(monsterType) {
                case 'monster1':
                    monsterText = 'Вы выходите из чащи на краю заброшенного рисового поля. Воздух густой и сладковатый от запаха гниющих стеблей. Посреди грязи, под низко нависшим туманом, стоит неестественно прямой скелет в пропитанной грязью, рваной японской военной форме. Пустой череп медленно поворачивается в вашу сторону с тихим скрежетом. Его костяные пальцы сжимают древко ржавого штыка-мебари.';
                    strength = 10;
                    break;
                case 'monster2':
                    monsterText = 'Пройдя заросший двор, вы замечаете у разбитого колодца одинокую фигуру женщины в потёртом, но чистом кимоно. Она сидит на корточках, беззвучно рыдая, а её длинные, чёрные волосы скрывают лицо. Воздух неподвижен, и лишь лунный свет выхватывает её из тьмы. При вашем приближении она поднимает голову. Её лицо бледно и прекрасно, но искажено безмолвной тоской. Она что-то шепчет, но вы слышите лишь шелест листвы. Пока вы не замечаете, что тень от её шеи на каменной плите неестественно длинна и извивается, как змея. Ещё миг — и раздастся сухой, костяной хруст, и её голова на гибкой, вытягивающейся шее рванётся к вам с шипящим воплем.';
                    strength = 11;
                    break;
                case 'monster3':
                    monsterText = 'Вы пробираетесь сквозь частокол высохших стеблей, и воздух с каждой секундой становится гуще. Впереди, в просвете между стволами, вы видите покосившуюся хижину. У входа, спиной к вам, сидит женщина в алом кимоно, нежно напевающая колыбельную. Ее длинные волосы струятся по спине, сливаясь с тенями. Но что-то не так... вы замечаете, что с корявых ветвей над ней свисают не лозы, а шелковистые коконы, некоторые из которых тихо шевелятся. Женщина оборачивается. Ее лицо поразительной красоты искажено голодной улыбкой, а за спиной, в тенях, плавно расходятся в стороны несколько длинных, блестящих, хитиновых конечностей. Ее рот открывается, и раздается нечеловеческий, щелкающий хрип.';
                    strength = 12;
                    break;
            }
            
            modalTitle.textContent = 'ВСТРЕЧА С МОНСТРОМ';
            modalText.innerHTML = `${monsterText}<br><br><strong>Сила противника – ${strength}</strong>`;
            modal.classList.add('active');
            
            // Показываем кнопки сражения
            battleButtons.style.display = 'flex';
            battleButtons.innerHTML = '';
            
            if (monsterType === 'monster1') {
                const attackButton = document.createElement('button');
                attackButton.className = 'battle-button';
                attackButton.textContent = 'бросить кубики, чтобы атаковать';
                attackButton.addEventListener('click', () => {
                    handleFirstMonsterAttack();
                });
                battleButtons.appendChild(attackButton);
            } else if (monsterType === 'monster2') {
                const bareHandsButton = document.createElement('button');
                bareHandsButton.className = 'battle-button';
                bareHandsButton.textContent = 'Биться голыми руками';
                bareHandsButton.addEventListener('click', () => {
                    handleSecondMonsterBareHands();
                });
                
                const swordButton = document.createElement('button');
                swordButton.className = 'battle-button';
                swordButton.textContent = 'Использовать Меч-кладенец';
                swordButton.addEventListener('click', () => {
                    handleSecondMonsterSword();
                });
                
                battleButtons.appendChild(bareHandsButton);
                battleButtons.appendChild(swordButton);
            } else if (monsterType === 'monster3') {
                if (gameState.items.includes('sword')) {
                    const bareHandsButton = document.createElement('button');
                    bareHandsButton.className = 'battle-button';
                    bareHandsButton.textContent = 'Биться голыми руками';
                    bareHandsButton.addEventListener('click', () => {
                        handleThirdMonsterAttack();
                    });
                    
                    const swordButton = document.createElement('button');
                    swordButton.className = 'battle-button';
                    swordButton.textContent = 'Использовать Меч-кладенец';
                    swordButton.addEventListener('click', () => {
                        handleThirdMonsterAttack();
                    });
                    
                    battleButtons.appendChild(bareHandsButton);
                    battleButtons.appendChild(swordButton);
                } else {
                    const attackButton = document.createElement('button');
                    attackButton.className = 'battle-button';
                    attackButton.textContent = 'Бросить кубики, чтобы сразиться';
                    attackButton.addEventListener('click', () => {
                        handleThirdMonsterAttack();
                    });
                    battleButtons.appendChild(attackButton);
                }
            }
        }

        // Обработка атаки на первого монстра
        function handleFirstMonsterAttack() {
            // Первый бросок
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 5 и 3.\nКажется богатырской силушки не хватило... Хорошо, что при начале игры вы получили кое-какой подарок. Попробуйте использовать его!';
            
            // Показываем возможность использовать куколку
            const dollCard = document.getElementById('item-doll');
            if (dollCard) {
                dollCard.style.pointerEvents = 'auto';
                dollCard.addEventListener('click', useDollAgainstFirstMonster);
            }
        }

        // Использование куколки против первого монстра
        function useDollAgainstFirstMonster() {
            // Убираем результат броска
            rollResult.style.display = 'none';
            
            // Убираем куколку
            const dollCard = document.getElementById('item-doll');
            if (dollCard) {
                dollCard.style.opacity = '0';
                setTimeout(() => {
                    dollCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'doll');
                }, 500);
            }
            
            // Второй бросок
            setTimeout(() => {
                rollResult.style.display = 'block';
                rollResult.textContent = 'результат бросков: 5 и 5\nДругое дело! Видим, теперь вы размялись. За победу над монстром применяется эффект локации «Получить оружие».';
                
                // Показываем меч-кладенец
                setTimeout(() => {
                    showItem('sword');
                    
                    // Обновляем подсказки
                    hintRight.textContent = 'Доступные действия: выложить карты локаций';
                    hintBottom.style.display = 'none';
                    
                    // Скрываем кнопки сражения
                    battleButtons.style.display = 'none';
                    
                    // Обновляем состояние
                    gameState.monster1Defeated = true;
                    
                    // Закрываем модальное окно
                    modal.classList.remove('active');
                }, 2000);
            }, 500);
        }

        // Обработка боя голыми руками со вторым монстром
        function handleSecondMonsterBareHands() {
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 6 и 6.\nВау! Да вы опытный боец! Поспешим в путь! И вновь применяем эффект карты локации – за победу над монстром получите предмет. Хотя, наверное, такому силачу уже никакие предметы не нужны';
            
            // Показываем амулет
            setTimeout(() => {
                showItem('amulet');
                
                // Обновляем подсказки
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
                hintBottom.style.display = 'none';
                
                // Скрываем кнопки сражения
                battleButtons.style.display = 'none';
                
                // Обновляем состояние
                gameState.monster2Defeated = true;
                
                // Закрываем модальное окно
                modal.classList.remove('active');
            }, 2000);
        }

        // Обработка боя с мечом со вторым монстром
        function handleSecondMonsterSword() {
            // Убираем меч
            const swordCard = document.getElementById('item-sword');
            if (swordCard) {
                swordCard.style.opacity = '0';
                setTimeout(() => {
                    swordCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'sword');
                }, 500);
            }
            
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 5 и 4.\nВсегда важно грамотно рассчитать силы. Хорошо, что у вас в ножнах оказалось такое оружие! И вновь применяем эффект карты локации – за победу над монстром получите предмет.';
            
            // Показываем амулет
            setTimeout(() => {
                showItem('amulet');
                
                // Обновляем подсказки
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
                hintBottom.style.display = 'none';
                
                // Скрываем кнопки сражения
                battleButtons.style.display = 'none';
                
                // Обновляем состояние
                gameState.monster2Defeated = true;
                
                // Закрываем модальное окно
                modal.classList.remove('active');
            }, 2000);
        }

        // Обработка атаки на третьего монстра
        function handleThirdMonsterAttack() {
            if (gameState.items.includes('sword')) {
                rollResult.style.display = 'block';
                rollResult.textContent = 'результат бросков: 2 и 1.\nНичего страшного! Каждый имеет право на маленькие неудачи. Иначе было бы не так захватывающе, верно? Используйте амулет, чтобы поскорее выбраться из этой скользкой ситуации';
            } else {
                rollResult.style.display = 'block';
                rollResult.textContent = 'Результат броска – 3 и 3.\nНеплохо, но против такого чудовища недостаточно. Скорее используйте свой амулет, чтобы сбежать.';
            }
            
            // Показываем возможность использовать амулет
            const amuletCard = document.getElementById('item-amulet');
            if (amuletCard) {
                amuletCard.style.pointerEvents = 'auto';
                amuletCard.addEventListener('click', useAmuletToEscape);
            }
        }

        // Использование амулета для побега
        function useAmuletToEscape() {
            // Убираем результат броска
            rollResult.style.display = 'none';
            
            // Убираем амулет
            const amuletCard = document.getElementById('item-amulet');
            if (amuletCard) {
                amuletCard.style.opacity = '0';
                setTimeout(() => {
                    amuletCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'amulet');
                }, 500);
            }
            
            // Показываем подсказку для выбора направления
            hintBottom.style.display = 'block';
            hintBottom.textContent = 'Доступные действия: выбрать карту направления';
            
            // Скрываем кнопки сражения
            battleButtons.style.display = 'none';
            
            // Обновляем состояние
            gameState.monster3Defeated = true;
            
            // Закрываем модальное окно
            modal.classList.remove('active');
        }

        // Показать локацию "команда"
        function showTeamLocation() {
            modalTitle.textContent = 'КОМАНДА';
            modalText.innerHTML = `
                <p>На этой локации применяется эффект: «завершить сюжетную арку «знакомство»</p>
                
                <p>Мы – KRAW Studio. Группа инициативных любителей настольных игр (и не только)</p>
                
                <p>И да, мы достаточно амбициозны (или безумны), чтобы параллельно работать над компьютерной версией той же игровой вселенной. Мы верим в силу трансмедийности и хотим, чтобы наши игроки могли погрузиться в мир игры с любой стороны.</p>
                
                <h3>Наша команда:</h3>
                
                <p><strong>Настольная игра:</strong><br>
                Анастасия Оглы, Павел Алексеев — гейм-дизайнеры<br>
                Александра Юрченко и Олеся Кан — графические дизайнеры<br>
                Александра Волкова — нарративный дизайнер</p>
                
                <p><strong>Компьютерная игра</strong><br>
                Максим Усачев — автор идеи, разработчик.<br>
                Никита Старков — саунд-дизайнер.<br>
                Дарья Горбунова — левел-дизайнер.</p>
                
                <p>Рады познакомиться и надеемся, что вам было с нами весело! Предлагаем и дальше веселиться рука об руку, разрабатывая эту настольную игру!</p>
                
                <p><strong>Наши контакты:</strong><br>
                Почта: мяумяу<br>
                Наши тг: гав гав</p>
            `;
            modal.classList.add('active');
            
            // Обновляем подсказки
            hintRight.style.display = 'none';
            hintBottom.style.display = 'none';
        }

        // Обновить трекер локации
        function updateLocationTracker(locationName) {
            locationTracker.textContent = `Текущая локация: ${locationName}`;
            locationTracker.style.display = 'block';
        }

        // Размещение карт локаций вокруг определенной карты
        function placeLocationCardsAround(locationType) {
            // Создаем 4 карты локаций вокруг текущей локации
            const positions = [
                { row: 1, col: 2 }, // сверху
                { row: 2, col: 3 }, // справа
                { row: 3, col: 2 }, // снизу
                { row: 2, col: 1 }  // слева
            ];
            
            // Очищаем сетку
            locationGrid.innerHTML = '';
            locationGrid.style.display = 'grid';
            
            positions.forEach((pos, index) => {
                const gridCell = document.createElement('div');
                gridCell.className = 'grid-cell';
                gridCell.dataset.row = pos.row;
                gridCell.dataset.col = pos.col;
                locationGrid.appendChild(gridCell);
                
                const locationCard = document.createElement('div');
                locationCard.className = 'card location-card';
                locationCard.style.backgroundImage = 'url("assets/back.png")';
                locationCard.style.opacity = '0';
                locationCard.dataset.position = index;
                
                // Определяем, какая локация будет открыта при клике
                let targetLocation;
                switch(locationType) {
                    case 'about':
                        targetLocation = 'monster1';
                        break;
                    case 'monster1':
                        targetLocation = 'purpose';
                        break;
                    case 'purpose':
                        targetLocation = 'monster2';
                        break;
                    case 'monster2':
                        targetLocation = 'coop';
                        break;
                    case 'coop':
                        targetLocation = 'monster3';
                        break;
                    case 'monster3':
                        targetLocation = 'team';
                        break;
                }
                
                locationCard.dataset.location = targetLocation;
                gridCell.appendChild(locationCard);
                
                // Анимация появления
                setTimeout(() => {
                    locationCard.style.opacity = '1';
                }, index * 200);
                
                // Обработчик клика
                locationCard.addEventListener('click', () => {
                    if (locationCard.style.backgroundImage.includes('back.png')) {
                        revealLocationCard(locationCard);
                    }
                });
            });
            
            // Показываем подсказку
            hintBottom.style.display = 'block';
            hintBottom.textContent = 'Доступные действия: Выбрать направление';
        }

        // Открыть карту локации
        function revealLocationCard(card) {
            const locationType = card.dataset.location;
            card.style.backgroundImage = `url("assets/card-${locationType}.png")`;
            
            // Обновляем состояние игры
            gameState.currentLocation = locationType;
            
            // Добавляем обработчик клика в зависимости от типа локации
            if (locationType === 'about' || locationType === 'purpose' || locationType === 'coop' || locationType === 'team') {
                card.addEventListener('click', () => {
                    showLocationEffect(locationType);
                });
                
                // Показываем подсказку
                hintBottom.style.display = 'block';
                hintBottom.textContent = 'Доступные действия: Применить эффект локации';
            } else if (locationType.includes('monster')) {
                card.addEventListener('click', () => {
                    showMonsterBattle(locationType);
                });
                
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    if (locationType === 'monster1') {
                        hintBottom.textContent = 'Ой-ой, кажется вас нагнал монстр\nДоступные действия: сразиться';
                    } else if (locationType === 'monster2') {
                        hintBottom.textContent = 'Ой-ой, кажется вы снова наткнулись на монстра\nДоступные действия: сразиться';
                    } else if (locationType === 'monster3') {
                        hintBottom.textContent = 'Ой-ой, никогда такого не было, и вот опять…\nДоступные действия: сразиться';
                    }
                }, 1000);
            }
            
            // Обновляем фазу игры
            if (locationType === 'about') {
                gameState.phase = 'afterAbout';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (locationType === 'monster1') {
                gameState.phase = 'afterMonster1';
            } else if (locationType === 'purpose') {
                gameState.phase = 'afterPurpose';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (locationType === 'monster2') {
                gameState.phase = 'afterMonster2';
            } else if (locationType === 'coop') {
                gameState.phase = 'afterCoop';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (locationType === 'monster3') {
                gameState.phase = 'afterMonster3';
            } else if (locationType === 'team') {
                // Конец игры
                showTeamLocation();
            }
        }

        // Инициализация игры
        function initGame() {
            // Показываем трекер локации
            updateLocationTracker('Стартовая локация');
        }

        // Запуск инициализации при загрузке страницы
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
