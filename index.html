<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сон Журавля</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Playfair Display', serif;
            background-image: url('wood.png');
            background-size: cover;
            background-position: center;
            height: 100vh;
            overflow: hidden;
            position: relative;
            color: #fff;
        }
        
        .game-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        /* Заголовки */
        .title-container {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 10;
            transition: opacity 0.5s;
        }
        
        .title {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }
        
        .subtitle {
            font-size: 24px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        
        /* Карты */
        .card {
            position: absolute;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: all 0.8s ease;
            cursor: pointer;
            background-size: cover;
            background-position: center;
        }
        
        .location-card {
            width: 200px;
            height: 200px;
        }
        
        .item-card, .direction-card {
            width: 140px;
            height: 200px;
        }
        
        .deck {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 200px;
            background-image: url('back.png');
            background-size: cover;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            cursor: pointer;
            z-index: 5;
            transition: all 0.8s ease;
        }
        
        /* Подсказки */
        .hint {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            max-width: 250px;
            line-height: 1.4;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        .hint-right {
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .hint-bottom {
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }
        
        /* Трекер локации */
        .location-tracker {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 10;
        }
        
        /* Модальное окно */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-content {
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .modal h2 {
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .modal p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .modal button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            margin-top: 10px;
        }
        
        /* Кнопки сражения */
        .battle-buttons {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }
        
        .battle-button {
            background-color: rgba(139, 69, 19, 0.9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        
        /* Результат броска */
        .roll-result {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            max-width: 400px;
            z-index: 10;
        }
        
        /* Скрытые карты */
        .hidden-card {
            transform: translateX(80%) rotate(90deg);
            transition: transform 0.5s ease;
        }
        
        .hidden-card:hover {
            transform: translateX(60%) rotate(90deg);
        }
        
        .hidden-direction {
            transform: translateY(80%);
            transition: transform 0.5s ease;
        }
        
        .hidden-direction:hover {
            transform: translateY(60%);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Заголовки -->
        <div class="title-container">
            <h1 class="title">Сон Журавля</h1>
            <p class="subtitle">Узнайте нас лучше</p>
        </div>
        
        <!-- Колода -->
        <div class="deck" id="deck"></div>
        
        <!-- Подсказки -->
        <div class="hint hint-right" id="hint-right"><<< Выложить стартовую локацию</div>
        <div class="hint hint-bottom" id="hint-bottom" style="display: none;"></div>
        
        <!-- Трекер локации -->
        <div class="location-tracker" id="location-tracker" style="display: none;"></div>
        
        <!-- Модальное окно -->
        <div class="modal" id="modal">
            <div class="modal-content">
                <h2 id="modal-title"></h2>
                <p id="modal-text"></p>
                <button id="modal-close">Вернуться к игре</button>
            </div>
        </div>
        
        <!-- Результат броска -->
        <div class="roll-result" id="roll-result" style="display: none;"></div>
        
        <!-- Кнопки сражения -->
        <div class="battle-buttons" id="battle-buttons" style="display: none;"></div>
    </div>

    <script>
        // Состояние игры
        const gameState = {
            currentLocation: null,
            items: [],
            locations: {},
            directions: [],
            phase: 'start',
            monster1Defeated: false,
            monster2Defeated: false,
            monster3Defeated: false
        };

        // DOM элементы
        const deck = document.getElementById('deck');
        const hintRight = document.getElementById('hint-right');
        const hintBottom = document.getElementById('hint-bottom');
        const locationTracker = document.getElementById('location-tracker');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const modalClose = document.getElementById('modal-close');
        const rollResult = document.getElementById('roll-result');
        const battleButtons = document.getElementById('battle-buttons');
        const titleContainer = document.querySelector('.title-container');

        // Обработчик клика на колоду
        deck.addEventListener('click', handleDeckClick);

        // Обработчик закрытия модального окна
        modalClose.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        // Функция обработки клика на колоду
        function handleDeckClick() {
            switch(gameState.phase) {
                case 'start':
                    startGame();
                    break;
                case 'afterStart':
                    placeLocationCards();
                    break;
                case 'afterAbout':
                    placeLocationCardsAround('about');
                    break;
                case 'afterMonster1':
                    placeLocationCardsAround('monster1');
                    break;
                case 'afterPurpose':
                    placeLocationCardsAround('purpose');
                    break;
                case 'afterMonster2':
                    placeLocationCardsAround('monster2');
                    break;
                case 'afterCoop':
                    placeLocationCardsAround('coop');
                    break;
                case 'afterMonster3':
                    placeLocationCardsAround('monster3');
                    break;
            }
        }

        // Начало игры
        function startGame() {
            // Перемещаем колоду
            deck.style.left = '10%';
            deck.style.top = '80%';
            deck.style.transform = 'translate(0, 0)';
            
            // Обновляем заголовки
            setTimeout(() => {
                titleContainer.querySelector('.title').textContent = 'Поздравляем с началом пути!';
                titleContainer.querySelector('.subtitle').style.display = 'none';
                
                // Показываем стартовую локацию
                showStartLocation();
            }, 800);
            
            gameState.phase = 'afterStart';
        }

        // Показать стартовую локацию
        function showStartLocation() {
            // Создаем карту стартовой локации
            const startCard = document.createElement('div');
            startCard.className = 'card location-card';
            startCard.style.backgroundImage = 'url("start.png")';
            startCard.style.left = '50%';
            startCard.style.top = '50%';
            startCard.style.transform = 'translate(-50%, -50%)';
            startCard.style.opacity = '0';
            document.querySelector('.game-container').appendChild(startCard);
            
            // Анимация появления
            setTimeout(() => {
                startCard.style.opacity = '1';
                
                // Показываем карту предмета
                showItem('doll');
                
                // Обновляем подсказки
                hintRight.textContent = 'Доступные действия:\n<<<Выложить новые карты локаций';
                hintBottom.style.display = 'block';
                hintBottom.innerHTML = 'Эффект карты локации: начать игру на знакомство<br>Полученные предметы: куколка-оберег';
                
                // Сохраняем текущую локацию
                gameState.currentLocation = 'start';
            }, 300);
        }

        // Показать карту предмета
        function showItem(itemType) {
            const itemCard = document.createElement('div');
            itemCard.className = 'card item-card';
            itemCard.style.backgroundImage = `url("item-${itemType}.png")`;
            itemCard.style.left = '60%';
            itemCard.style.top = '50%';
            itemCard.style.transform = 'translate(-50%, -50%)';
            itemCard.style.opacity = '0';
            itemCard.id = `item-${itemType}`;
            document.querySelector('.game-container').appendChild(itemCard);
            
            // Анимация появления
            setTimeout(() => {
                itemCard.style.opacity = '1';
                
                // Добавляем в состояние игры
                gameState.items.push(itemType);
            }, 300);
        }

        // Размещение карт локаций вокруг стартовой локации
        function placeLocationCards() {
            // Убираем карту куколки
            const dollCard = document.getElementById('item-doll');
            if (dollCard) {
                dollCard.style.transform = 'translateX(80%) rotate(90deg)';
                dollCard.classList.add('hidden-card');
            }
            
            // Скрываем заголовок
            titleContainer.style.opacity = '0';
            
            // Создаем 4 карты локаций
            const positions = [
                { left: '50%', top: '30%', transform: 'translate(-50%, -50%)' }, // сверху
                { left: '70%', top: '50%', transform: 'translate(-50%, -50%)' }, // справа
                { left: '50%', top: '70%', transform: 'translate(-50%, -50%)' }, // снизу
                { left: '30%', top: '50%', transform: 'translate(-50%, -50%)' }  // слева
            ];
            
            positions.forEach((pos, index) => {
                const locationCard = document.createElement('div');
                locationCard.className = 'card location-card';
                locationCard.style.backgroundImage = 'url("back.png")';
                locationCard.style.left = pos.left;
                locationCard.style.top = pos.top;
                locationCard.style.transform = pos.transform;
                locationCard.style.opacity = '0';
                locationCard.dataset.position = index;
                locationCard.dataset.location = 'about'; // Все ведут к карте "об игре"
                document.querySelector('.game-container').appendChild(locationCard);
                
                // Анимация появления
                setTimeout(() => {
                    locationCard.style.opacity = '1';
                }, index * 200);
                
                // Обработчик клика
                locationCard.addEventListener('click', () => {
                    if (locationCard.style.backgroundImage.includes('back.png')) {
                        revealLocationCard(locationCard);
                    }
                });
            });
            
            // Показываем карты направлений
            showDirectionCards();
            
            // Обновляем подсказки
            hintBottom.textContent = 'Доступные действия: выбрать направление';
            
            gameState.phase = 'locationCardsPlaced';
        }

        // Показать карты направлений
        function showDirectionCards() {
            const directions = ['up', 'right', 'down', 'left'];
            const positions = [
                { left: '40%', bottom: '10%' },
                { left: '50%', bottom: '10%' },
                { left: '60%', bottom: '10%' },
                { left: '70%', bottom: '10%' }
            ];
            
            directions.forEach((dir, index) => {
                const directionCard = document.createElement('div');
                directionCard.className = 'card direction-card hidden-direction';
                directionCard.style.backgroundImage = `url("direction-${dir}.png")`;
                directionCard.style.left = positions[index].left;
                directionCard.style.bottom = positions[index].bottom;
                directionCard.dataset.direction = dir;
                document.querySelector('.game-container').appendChild(directionCard);
                
                // Обработчик клика
                directionCard.addEventListener('click', () => {
                    handleDirectionClick(dir);
                });
            });
        }

        // Обработка клика на карту направления
        function handleDirectionClick(direction) {
            // Определяем, какая карта должна открыться
            let targetLocation;
            
            switch(gameState.currentLocation) {
                case 'start':
                    // Все направления ведут к карте "об игре"
                    targetLocation = 'about';
                    break;
                case 'about':
                    // Одно из направлений ведет к монстру 1
                    targetLocation = 'monster1';
                    break;
                case 'monster1':
                    // Одно из направлений ведет к карте "для кого и зачем"
                    targetLocation = 'purpose';
                    break;
                case 'purpose':
                    // Одно из направлений ведет к монстру 2
                    targetLocation = 'monster2';
                    break;
                case 'monster2':
                    // Одно из направлений ведет к карте "сотрудничество"
                    targetLocation = 'coop';
                    break;
                case 'coop':
                    // Одно из направлений ведет к монстру 3
                    targetLocation = 'monster3';
                    break;
                case 'monster3':
                    // Одно из направлений ведет к карте "команда"
                    targetLocation = 'team';
                    break;
                default:
                    targetLocation = 'about';
            }
            
            // Обновляем трекер локации
            updateLocationTracker(targetLocation);
            
            // Показываем карту локации
            showLocationCard(targetLocation);
            
            // Обновляем состояние игры
            gameState.currentLocation = targetLocation;
            
            // Скрываем подсказку направлений
            hintBottom.style.display = 'none';
            
            // Обновляем фазу игры
            if (targetLocation === 'about') {
                gameState.phase = 'afterAbout';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (targetLocation === 'monster1') {
                gameState.phase = 'afterMonster1';
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Ой-ой, кажется вас нагнал монстр\nДоступные действия: сразиться';
                }, 1000);
            } else if (targetLocation === 'purpose') {
                gameState.phase = 'afterPurpose';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (targetLocation === 'monster2') {
                gameState.phase = 'afterMonster2';
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Ой-ой, кажется вы снова наткнулись на монстра\nДоступные действия: сразиться';
                }, 1000);
            } else if (targetLocation === 'coop') {
                gameState.phase = 'afterCoop';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (targetLocation === 'monster3') {
                gameState.phase = 'afterMonster3';
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Ой-ой, никогда такого не было, и вот опять…\nДоступные действия: сразиться';
                }, 1000);
            } else if (targetLocation === 'team') {
                // Конец игры
                showTeamLocation();
            }
        }

        // Показать карту локации
        function showLocationCard(locationType) {
            // Создаем карту локации
            const locationCard = document.createElement('div');
            locationCard.className = 'card location-card';
            locationCard.style.backgroundImage = `url("card-${locationType}.png")`;
            locationCard.style.left = '50%';
            locationCard.style.top = '50%';
            locationCard.style.transform = 'translate(-50%, -50%)';
            locationCard.style.opacity = '0';
            locationCard.id = `location-${locationType}`;
            document.querySelector('.game-container').appendChild(locationCard);
            
            // Анимация появления
            setTimeout(() => {
                locationCard.style.opacity = '1';
                
                // Добавляем обработчик клика в зависимости от типа локации
                if (locationType === 'about' || locationType === 'purpose' || locationType === 'coop' || locationType === 'team') {
                    locationCard.addEventListener('click', () => {
                        showLocationEffect(locationType);
                    });
                    
                    // Показываем подсказку
                    hintBottom.style.display = 'block';
                    hintBottom.textContent = 'Доступные действия: применить эффект локации';
                } else if (locationType.includes('monster')) {
                    locationCard.addEventListener('click', () => {
                        showMonsterBattle(locationType);
                    });
                }
            }, 300);
        }

        // Показать эффект локации
        function showLocationEffect(locationType) {
            let title, text;
            
            switch(locationType) {
                case 'about':
                    title = 'Об игре';
                    text = 'На этой локации применяется эффект: «получение сакральных знаний»';
                    break;
                case 'purpose':
                    title = 'Для кого и зачем';
                    text = 'На этой локации применяется эффект: «приоткрыть завесу тайны». Ядро нашей аудитории — «Игровой лидер». Это человек, который знакомит друзей с новыми играми, «заряжает» компанию, читает правила и является душой компании. Мы создаём игру, которая станет его новым козырем в коллекции. Наша игра идеально подойдёт для трёх сегментов игроков: Стратеги и тактики. Тем, кто любит выстраивать стратегии, комбинировать карты и наслаждаться чувством контроля над сложной системой. Фанаты мифологии. Те, кто изучает культуру стран, любит погружаться в атмосферные сеттинги. Это люди, которые увлекаются русским и/или японским фольклором, а еще оценят их тонкое переплетение. Визуалы и эстеты. Те, для кого важен визуальный стиль. Мы создаем визуал, где старославянские узоры встречаются с лаконичной японской графикой. Кому понравится? (Смежный игровой опыт): Если вы играли в: «Ярость дракулы», «Шепот за стеной», «Нечто», «Тираны подземья», «Иниш», «Кто накормит кракена?». То вероятнее всего, вам порекомендуют «Сон журавля».';
                    break;
                case 'coop':
                    title = 'Сотрудничество';
                    text = 'На этой локации применяется эффект: «стать друзьями». Что мы предлагаем партнёру-издателю: Готовый, протестированный концепт. Мы предлагаем прототип настольной игры с продуманным дизайном карт, правилами и готовой визуальной концепцией. Весь предпродакшн — на нас. Уникальное трансмедийное преимущество. Параллельно мы ведём разработку компьютерной игры «Сон журавля» — это трансмедийное расширение настольной, но более нарративно насыщенная и продолжительная игра, предназначенная для личного прохождения. С точки зрения маркетинга — это хорошая возможность для кросс-промоушена. Выход компьютерной игры подогреет интерес к настольной, и наоборот. Мы создаём целый мир для нашей аудитории. Инициативная и вовлечённая команда. Мы горим своим проектом. Мы готовы активно участвовать на всех этапах: от доработки дизайна и организации тестирований до поддержки маркетинговых активностей. Будем рады стать вашими партнерами! Что мы ищем от партнёра: Экспертизу и поддержку в издании. Мы хотим работать с профессионалами, которые помогут нам вывести игру на рынок и поддержать нас на этапах производстве продукции и дистрибуции. Партнёрство в маркетинге и продвижении. Мы верим в наш продукт и готовы вкладывать силы, но нам нужна ваша мощь и опыт в том, чтобы громко заявить о себе и донести игру до нашей целевой аудитории.';
                    break;
            }
            
            modalTitle.textContent = title;
            modalText.textContent = text;
            modal.classList.add('active');
        }

        // Показать битву с монстром
        function showMonsterBattle(monsterType) {
            let monsterText, strength;
            
            switch(monsterType) {
                case 'monster1':
                    monsterText = 'Вы выходите из чащи на краю заброшенного рисового поля. Воздух густой и сладковатый от запаха гниющих стеблей. Посреди грязи, под низко нависшим туманом, стоит неестественно прямой скелет в пропитанной грязью, рваной японской военной форме. Пустой череп медленно поворачивается в вашу сторону с тихим скрежетом. Его костяные пальцы сжимают древко ржавого штыка-мебари.';
                    strength = 10;
                    break;
                case 'monster2':
                    monsterText = 'Пройдя заросший двор, вы замечаете у разбитого колодца одинокую фигуру женщины в потёртом, но чистом кимоно. Она сидит на корточках, беззвучно рыдая, а её длинные, чёрные волосы скрывают лицо. Воздух неподвижен, и лишь лунный свет выхватывает её из тьмы. При вашем приближении она поднимает голову. Её лицо бледно и прекрасно, но искажено безмолвной тоской. Она что-то шепчет, но вы слышите лишь шелест листвы. Пока вы не замечаете, что тень от её шеи на каменной плите неестественно длинна и извивается, как змея. Ещё миг — и раздастся сухой, костяной хруст, и её голова на гибкой, вытягивающейся шее рванётся к вам с шипящим воплем.';
                    strength = 11;
                    break;
                case 'monster3':
                    monsterText = 'Вы пробираетесь сквозь частокол высохших стеблей, и воздух с каждой секундой становится гуще. Впереди, в просвете между стволами, вы видите покосившуюся хижину. У входа, спиной к вам, сидит женщина в алом кимоно, нежно напевающая колыбельную. Ее длинные волосы струятся по спине, сливаясь с тенями. Но что-то не так... вы замечаете, что с корявых ветвей над ней свисают не лозы, а шелковистые коконы, некоторые из которых тихо шевелятся. Женщина оборачивается. Ее лицо поразительной красоты искажено голодной улыбкой, а за спиной, в тенях, плавно расходятся в стороны несколько длинных, блестящих, хитиновых конечностей. Ее рот открывается, и раздается нечеловеческий, щелкающий хрип.';
                    strength = 12;
                    break;
            }
            
            modalTitle.textContent = 'Встреча с монстром';
            modalText.innerHTML = `${monsterText}<br><br>Сила противника – ${strength}`;
            modal.classList.add('active');
            
            // Показываем кнопки сражения
            battleButtons.style.display = 'flex';
            battleButtons.innerHTML = '';
            
            if (monsterType === 'monster1') {
                const attackButton = document.createElement('button');
                attackButton.className = 'battle-button';
                attackButton.textContent = 'бросить кубики, чтобы атаковать';
                attackButton.addEventListener('click', () => {
                    handleFirstMonsterAttack();
                });
                battleButtons.appendChild(attackButton);
            } else if (monsterType === 'monster2') {
                const bareHandsButton = document.createElement('button');
                bareHandsButton.className = 'battle-button';
                bareHandsButton.textContent = 'Биться голыми руками';
                bareHandsButton.addEventListener('click', () => {
                    handleSecondMonsterBareHands();
                });
                
                const swordButton = document.createElement('button');
                swordButton.className = 'battle-button';
                swordButton.textContent = 'Использовать Меч-кладенец';
                swordButton.addEventListener('click', () => {
                    handleSecondMonsterSword();
                });
                
                battleButtons.appendChild(bareHandsButton);
                battleButtons.appendChild(swordButton);
            } else if (monsterType === 'monster3') {
                if (gameState.items.includes('sword')) {
                    const bareHandsButton = document.createElement('button');
                    bareHandsButton.className = 'battle-button';
                    bareHandsButton.textContent = 'Биться голыми руками';
                    bareHandsButton.addEventListener('click', () => {
                        handleThirdMonsterAttack();
                    });
                    
                    const swordButton = document.createElement('button');
                    swordButton.className = 'battle-button';
                    swordButton.textContent = 'Использовать Меч-кладенец';
                    swordButton.addEventListener('click', () => {
                        handleThirdMonsterAttack();
                    });
                    
                    battleButtons.appendChild(bareHandsButton);
                    battleButtons.appendChild(swordButton);
                } else {
                    const attackButton = document.createElement('button');
                    attackButton.className = 'battle-button';
                    attackButton.textContent = 'Бросить кубики, чтобы сразиться';
                    attackButton.addEventListener('click', () => {
                        handleThirdMonsterAttack();
                    });
                    battleButtons.appendChild(attackButton);
                }
            }
        }

        // Обработка атаки на первого монстра
        function handleFirstMonsterAttack() {
            // Первый бросок
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 5 и 3.\nКажется богатырской силушки не хватило... Хорошо, что при начале игры вы получили кое-какой подарок. Попробуйте использовать его!';
            
            // Показываем возможность использовать куколку
            const dollCard = document.getElementById('item-doll');
            if (dollCard) {
                dollCard.style.pointerEvents = 'auto';
                dollCard.addEventListener('click', useDollAgainstFirstMonster);
            }
        }

        // Использование куколки против первого монстра
        function useDollAgainstFirstMonster() {
            // Убираем результат броска
            rollResult.style.display = 'none';
            
            // Убираем куколку
            const dollCard = document.getElementById('item-doll');
            if (dollCard) {
                dollCard.style.opacity = '0';
                setTimeout(() => {
                    dollCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'doll');
                }, 500);
            }
            
            // Второй бросок
            setTimeout(() => {
                rollResult.style.display = 'block';
                rollResult.textContent = 'результат бросков: 5 и 5\nДругое дело! Видим, теперь вы размялись. За победу над монстром применяется эффект локации «Получить оружие».';
                
                // Показываем меч-кладенец
                setTimeout(() => {
                    showItem('sword');
                    
                    // Обновляем подсказки
                    hintRight.textContent = 'Доступные действия: выложить карты локаций';
                    hintBottom.style.display = 'none';
                    
                    // Скрываем кнопки сражения
                    battleButtons.style.display = 'none';
                    
                    // Обновляем состояние
                    gameState.monster1Defeated = true;
                }, 2000);
            }, 500);
        }

        // Обработка боя голыми руками со вторым монстром
        function handleSecondMonsterBareHands() {
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 6 и 6.\nВау! Да вы опытный боец! Поспешим в путь! И вновь применяем эффект карты локации – за победу над монстром получите предмет. Хотя, наверное, такому силачу уже никакие предметы не нужны';
            
            // Показываем амулет
            setTimeout(() => {
                showItem('amulet');
                
                // Обновляем подсказки
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
                hintBottom.style.display = 'none';
                
                // Скрываем кнопки сражения
                battleButtons.style.display = 'none';
                
                // Обновляем состояние
                gameState.monster2Defeated = true;
            }, 2000);
        }

        // Обработка боя с мечом со вторым монстром
        function handleSecondMonsterSword() {
            // Убираем меч
            const swordCard = document.getElementById('item-sword');
            if (swordCard) {
                swordCard.style.opacity = '0';
                setTimeout(() => {
                    swordCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'sword');
                }, 500);
            }
            
            rollResult.style.display = 'block';
            rollResult.textContent = 'результат бросков: 5 и 4.\nВсегда важно грамотно рассчитать силы. Хорошо, что у вас в ножнах оказалось такое оружие! И вновь применяем эффект карты локации – за победу над монстром получите предмет.';
            
            // Показываем амулет
            setTimeout(() => {
                showItem('amulet');
                
                // Обновляем подсказки
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
                hintBottom.style.display = 'none';
                
                // Скрываем кнопки сражения
                battleButtons.style.display = 'none';
                
                // Обновляем состояние
                gameState.monster2Defeated = true;
            }, 2000);
        }

        // Обработка атаки на третьего монстра
        function handleThirdMonsterAttack() {
            if (gameState.items.includes('sword')) {
                rollResult.style.display = 'block';
                rollResult.textContent = 'результат бросков: 2 и 1.\nНичего страшного! Каждый имеет право на маленькие неудачи. Иначе было бы не так захватывающе, верно? Используйте амулет, чтобы поскорее выбраться из этой скользкой ситуации';
            } else {
                rollResult.style.display = 'block';
                rollResult.textContent = 'Результат броска – 3 и 3.\nНеплохо, но против такого чудовища недостаточно. Скорее используйте свой амулет, чтобы сбежать.';
            }
            
            // Показываем возможность использовать амулет
            const amuletCard = document.getElementById('item-amulet');
            if (amuletCard) {
                amuletCard.style.pointerEvents = 'auto';
                amuletCard.addEventListener('click', useAmuletToEscape);
            }
        }

        // Использование амулета для побега
        function useAmuletToEscape() {
            // Убираем результат броска
            rollResult.style.display = 'none';
            
            // Убираем амулет
            const amuletCard = document.getElementById('item-amulet');
            if (amuletCard) {
                amuletCard.style.opacity = '0';
                setTimeout(() => {
                    amuletCard.remove();
                    gameState.items = gameState.items.filter(item => item !== 'amulet');
                }, 500);
            }
            
            // Показываем подсказку для выбора направления
            hintBottom.style.display = 'block';
            hintBottom.textContent = 'Доступные действия: выбрать карту направления';
            
            // Скрываем кнопки сражения
            battleButtons.style.display = 'none';
            
            // Обновляем состояние
            gameState.monster3Defeated = true;
        }

        // Показать локацию "команда"
        function showTeamLocation() {
            modalTitle.textContent = 'Команда';
            modalText.textContent = 'На этой локации применяется эффект: «завершить сюжетную арку «знакомство». Мы – KRAW Studio. Группа инициативных любителей настольных игр (и не только). И да, мы достаточно амбициозны (или безумны), чтобы параллельно работать над компьютерной версией той же игровой вселенной. Мы верим в силу трансмедийности и хотим, чтобы наши игроки могли погрузиться в мир игры с любой стороны. Наша команда: Настольная игра: Анастасия Оглы, Павел Алексеев — гейм-дизайнеры. Александра Юрченко и Олеся Кан — графические дизайнеры. Александра Волкова — нарративный дизайнер. Компьютерная игра: Максим Усачев — автор идеи, разработчик. Никита Старков — саунд-дизайнер. Дарья Горбунова — левел-дизайнер. Рады познакомиться и надеемся, что вам было с нами весело! Предлагаем и дальше веселиться рука об руку, разрабатывая эту настольную игру! Наши контакты: Почта: мяумяу. Наши тг: гав гав';
            modal.classList.add('active');
            
            // Обновляем подсказки
            hintRight.style.display = 'none';
            hintBottom.style.display = 'none';
        }

        // Обновить трекер локации
        function updateLocationTracker(location) {
            const locationNames = {
                'start': 'Стартовая локация',
                'about': 'Об игре',
                'monster1': 'Встреча с первым монстром',
                'purpose': 'Для кого и зачем',
                'monster2': 'Встреча со вторым монстром',
                'coop': 'Сотрудничество',
                'monster3': 'Встреча с третьим монстром',
                'team': 'Команда'
            };
            
            locationTracker.textContent = `Текущая локация: ${locationNames[location]}`;
            locationTracker.style.display = 'block';
        }

        // Размещение карт локаций вокруг определенной карты
        function placeLocationCardsAround(locationType) {
            // Создаем 4 карты локаций вокруг текущей локации
            const positions = [
                { left: '50%', top: '30%', transform: 'translate(-50%, -50%)' }, // сверху
                { left: '70%', top: '50%', transform: 'translate(-50%, -50%)' }, // справа
                { left: '50%', top: '70%', transform: 'translate(-50%, -50%)' }, // снизу
                { left: '30%', top: '50%', transform: 'translate(-50%, -50%)' }  // слева
            ];
            
            positions.forEach((pos, index) => {
                const locationCard = document.createElement('div');
                locationCard.className = 'card location-card';
                locationCard.style.backgroundImage = 'url("back.png")';
                locationCard.style.left = pos.left;
                locationCard.style.top = pos.top;
                locationCard.style.transform = pos.transform;
                locationCard.style.opacity = '0';
                locationCard.dataset.position = index;
                
                // Определяем, какая локация будет открыта при клике
                let targetLocation;
                switch(locationType) {
                    case 'about':
                        targetLocation = 'monster1';
                        break;
                    case 'monster1':
                        targetLocation = 'purpose';
                        break;
                    case 'purpose':
                        targetLocation = 'monster2';
                        break;
                    case 'monster2':
                        targetLocation = 'coop';
                        break;
                    case 'coop':
                        targetLocation = 'monster3';
                        break;
                    case 'monster3':
                        targetLocation = 'team';
                        break;
                }
                
                locationCard.dataset.location = targetLocation;
                document.querySelector('.game-container').appendChild(locationCard);
                
                // Анимация появления
                setTimeout(() => {
                    locationCard.style.opacity = '1';
                }, index * 200);
                
                // Обработчик клика
                locationCard.addEventListener('click', () => {
                    if (locationCard.style.backgroundImage.includes('back.png')) {
                        revealLocationCard(locationCard);
                    }
                });
            });
            
            // Показываем подсказку
            hintBottom.style.display = 'block';
            hintBottom.textContent = 'Доступные действия: выбрать направление';
        }

        // Открыть карту локации
        function revealLocationCard(card) {
            const locationType = card.dataset.location;
            card.style.backgroundImage = `url("card-${locationType}.png")`;
            
            // Обновляем трекер локации
            updateLocationTracker(locationType);
            
            // Обновляем состояние игры
            gameState.currentLocation = locationType;
            
            // Добавляем обработчик клика в зависимости от типа локации
            if (locationType === 'about' || locationType === 'purpose' || locationType === 'coop' || locationType === 'team') {
                card.addEventListener('click', () => {
                    showLocationEffect(locationType);
                });
                
                // Показываем подсказку
                hintBottom.style.display = 'block';
                hintBottom.textContent = 'Доступные действия: применить эффект локации';
            } else if (locationType.includes('monster')) {
                card.addEventListener('click', () => {
                    showMonsterBattle(locationType);
                });
                
                // Показываем подсказку для монстра
                setTimeout(() => {
                    hintBottom.style.display = 'block';
                    if (locationType === 'monster1') {
                        hintBottom.textContent = 'Ой-ой, кажется вас нагнал монстр\nДоступные действия: сразиться';
                    } else if (locationType === 'monster2') {
                        hintBottom.textContent = 'Ой-ой, кажется вы снова наткнулись на монстра\nДоступные действия: сразиться';
                    } else if (locationType === 'monster3') {
                        hintBottom.textContent = 'Ой-ой, никогда такого не было, и вот опять…\nДоступные действия: сразиться';
                    }
                }, 1000);
            }
            
            // Обновляем фазу игры
            if (locationType === 'about') {
                gameState.phase = 'afterAbout';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (locationType === 'monster1') {
                gameState.phase = 'afterMonster1';
            } else if (locationType === 'purpose') {
                gameState.phase = 'afterPurpose';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (locationType === 'monster2') {
                gameState.phase = 'afterMonster2';
            } else if (locationType === 'coop') {
                gameState.phase = 'afterCoop';
                hintRight.textContent = 'Доступные действия: выложить карты локаций';
            } else if (locationType === 'monster3') {
                gameState.phase = 'afterMonster3';
            } else if (locationType === 'team') {
                // Конец игры
                showTeamLocation();
            }
        }

        // Инициализация игры
        function initGame() {
            // Показываем трекер локации
            updateLocationTracker('start');
        }

        // Запуск инициализации при загрузке страницы
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
